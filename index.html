<!DOCTYPE html>
<html lang="zh-Hans-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PageOS 用户桌面</title>
    <style>
      /* 全局 */
      * {
        color: var(--secondary-font-color);
        font-family: "Maple Mono CN", "Courier New", Courier, monospace;
        box-sizing: border-box;
        transition: all 0.2s ease;
      }

      ::selection {
        background: var(--accent-bg-color);
        color: var(--accent-font-color);
      }

      :root,
      body {
        height: 100%;
        margin: 0;
        overflow: hidden;

        --accent-color: #64ffda; /* 强调色：边框 */
        --secondary-color: #00695c; /* 次要色：未激活边框 */
        --danger-color: #ff6d00; /* 着重色：边框 */
        --accent-bg-color: #009688;
        --secondary-bg-color: #616161;
        --content-bg-color: #424242;
        --accent-font-color: #f5f5f5;
        --secondary-font-color: #eeeeee;

        --margin-padding: 0.5rem;
        --border-thickness: 0.2rem;
        --border-radius: 0.5rem;
        --title-bar-height: 2rem;
        --title-bar-justify-content: left;
        --task-bar-height: 3rem;

        --shadow: 0.6rem 0.6rem 0.1rem 0.1rem rgba(0, 0, 0, 0.2);
        --focused-bg-color: rgba(255, 255, 255, 0.1);

        --favicon: url("data:image/svg+xml;charset=utf-8;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIj4KICA8IS0tIOWkluahhuefqeW9oiAtLT4KICA8cmVjdCB4PSIyIiB5PSIyIiB3aWR0aD0iMjgiIGhlaWdodD0iMjgiIHJ4PSIxMCIgcnk9IjEwIgogICAgZmlsbD0iIzQyNDI0MiIKICAgIHN0cm9rZT0iIzAwNjk1YyIKICAgIHN0cm9rZS13aWR0aD0iNCIvPgoKICA8IS0tIOW3puecvO+8muWwj+WchueCuSAtLT4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjE0IiByPSIxLjUiIGZpbGw9IiNmNWY1ZjUiIC8+CgogIDwhLS0g5Y+z55y877ya5bCP5ZyG54K5IC0tPgogIDxjaXJjbGUgY3g9IjIwIiBjeT0iMTQiIHI9IjEuNSIgZmlsbD0iI2Y1ZjVmNSIgLz4KCiAgPCEtLSDpvLvlrZDvvJrnq5bnur8gLS0+CiAgPGxpbmUgeDE9IjE2IiB5MT0iMTYiIHgyPSIxNiIgeTI9IjE4IiBzdHJva2U9IiNmNWY1ZjUiIHN0cm9rZS13aWR0aD0iMS41IiAvPgoKICA8IS0tIOW+rueskeeahOWYtO+8muS4iuaJrOeahOW8p+e6vyAtLT4KICA8cGF0aCBkPSJNIDE0IDIwIFEgMTYgMjIgMTggMjAiIAogICAgICAgIGZpbGw9Im5vbmUiIAogICAgICAgIHN0cm9rZT0iI2Y1ZjVmNSIgCiAgICAgICAgc3Ryb2tlLXdpZHRoPSIxLjUiIAogICAgICAgIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgLz4KPC9zdmc+");
      }

      button {
        background-color: var(--secondary-bg-color);
        background-position: center;
        background-repeat: no-repeat;
        border: none;
        display: flex;
        align-self: center;
        justify-content: center;

        &:hover,
        &:focus {
          background-color: var(--focused-bg-color);
        }
      }

      .warning,
      .error {
        color: var(--danger-color);
      }
    </style>
    <style>
      /* 窗口样式 */
      #windows-container {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        pointer-events: none;
        z-index: 1000;
      }

      .window {
        color: var(--secondary-font-color);
        position: absolute;
        display: flex;
        flex-direction: column;
        background: var(--content-bg-color);
        box-sizing: border-box;
        border: var(--border-thickness) solid var(--secondary-color);
        border-radius: var(--border-radius);
        overflow: hidden;
        pointer-events: auto;

        &.dragging {
          transition: left 0s, right 0s;
        }

        &.resizing {
          transition: width 0s, height 0s;
        }

        &.focused {
          --secondary-font-color: var(--accent-font-color);
          --secondary-color: var(--accent-color);
          box-shadow: var(--shadow);
        }

        &.dragging,
        &.resizing {
          --secondary-color: var(--danger-color);

          iframe {
            display: none;
          }
        }

        &.borderless {
          border: none;
          .window-title-bar {
            height: 0;
            display: none;
          }
        }

        &.minimized {
          /* max-height: var(--title-bar-height); */
          opacity: 0;
          transform: scale(0.8);
          pointer-events: none;
        }

        &.fullscreen {
          top: 0 !important;
          left: 0 !important;
          width: 100% !important;
          height: 100% !important;
          border: none !important;
          border-radius: 0;
          box-shadow: none !important;
        }

        &.borderless,
        &.fullscreen {
          .resize-handle {
            display: none;
          }
        }

        .resize-handle {
          border-radius: calc(0.5 * var(--border-radius)) 0 0 0;
          position: absolute;
          bottom: 0;
          right: 0;
          width: calc(2 * var(--border-thickness));
          height: calc(2 * var(--border-thickness));
          background: var(--secondary-color);
          cursor: nwse-resize;
        }
      }

      .window-title-bar {
        height: var(--title-bar-height);
        background: var(--accent-bg-color);
        display: flex;
        align-items: center;
        justify-content: space-between;
        cursor: move;
        user-select: none;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;

        & > *:first-child {
          margin: 0 var(--margin-padding);
          min-width: calc(var(--title-bar-height) - var(--margin-padding));
        }
      }

      .window-title {
        flex: 1;
        justify-content: var(--title-bar-justify-content);
        font-weight: bold;
      }

      .window-icon {
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .window-controls {
        display: flex;
      }

      .window-controls button {
        color: var(--secondary-font-color);
        background: none;
        border: none;
        width: var(--title-bar-height);
        height: var(--title-bar-height);
        cursor: pointer;
        font-size: 16px;
        display: flex;
        align-items: center;
        justify-content: center;

        &:hover,
        &:focus {
          background: var(--focused-bg-color);
        }
        &.close:hover,
        &.close:focus {
          background-color: var(--danger-color);
        }
      }

      .window-tab-bar {
        display: flex;
        background: var(--content-bg-color);
      }

      .tab {
        font-size: small;
        padding: var(--margin-padding);
        cursor: pointer;
        border-bottom: var(--border-thickness) solid transparent;
        user-select: none;
        &:hover {
          background: var(--focused-bg-color);
        }
        &.active {
          background: var(--secondary-bg-color);
          border-bottom: var(--border-thickness) solid var(--secondary-color);
        }
      }

      .window-content {
        flex: 1;
        overflow: auto;
        display: flex;

        .tab-content {
          flex: 1;
          display: none;

          &.active {
            display: flex;
            flex-direction: column;
            gap: var(--margin-padding);
          }
        }
      }
    </style>
    <style>
      /* 背景 */
      bg {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        pointer-events: none;
        overflow: hidden;
        z-index: -1;
        background: url("data:image/svg+xml;charset=utf-8;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyBpZD0ic3ZnUHJldmlldyIgd2lkdGg9IjI4ODAiIGhlaWdodD0iMTgwMCIgc3R5bGU9IiIgdmVyc2lvbj0iMS4xIiB2aWV3Qm94PSIwIDAgMjg4MCAxODAwIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogPGRlZnM+CiAgPGxpbmVhckdyYWRpZW50IGlkPSJiZy1ncmFkaWVudCIgeDE9Ii42NTQ1IiB4Mj0iLjM0NTUiIHkxPSIuOTc1NSIgeTI9Ii4wMjQ0NyI+CiAgIDxzdG9wIHN0b3AtY29sb3I9IiMwMDRkNDAiIG9mZnNldD0iMCIvPgogICA8c3RvcCBzdG9wLWNvbG9yPSIjMDA4OTdiIiBvZmZzZXQ9IjEiLz4KICA8L2xpbmVhckdyYWRpZW50PgogIDxmaWx0ZXIgaWQ9InNoYWRvdyIgeD0iMCIgeT0iMCIgd2lkdGg9IjEiIGhlaWdodD0iMSI+CiAgIDxmZURyb3BTaGFkb3cgZHg9IjMiIGR5PSIzIiBmbG9vZC1jb2xvcj0icmdiYSgwLCAwLCAwLCAwLjUpIiBzdGREZXZpYXRpb249IjUiLz4KICA8L2ZpbHRlcj4KIDwvZGVmcz4KIDxyZWN0IHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIGZpbGw9InVybCgjYmctZ3JhZGllbnQpIi8+CiA8Y2lyY2xlIHRyYW5zZm9ybT0icm90YXRlKDQwLjE2IDM3My43IDEwNzYpIiBjeD0iMzczLjciIGN5PSIxMDc2IiByPSI0NC43MSIgZmlsbD0iaHNsYSgzMzEuNTY2ODk4NDg5MjkyMjcsIDcwJSwgODAlLCAwLjEyNDkwOTc3NjIyOTYxMjM4KSIgZmlsdGVyPSJibHVyKDMuMTM0NTM2MjUzNzc4OTQ3cHgpIiBvcGFjaXR5PSIuMTI0OSIvPgogPGVsbGlwc2UgdHJhbnNmb3JtPSJyb3RhdGUoMTA1IDI4Mi42IDM3Ni45KSIgY3g9IjI4Mi42IiBjeT0iMzc2LjkiIHJ4PSIxMzcuOCIgcnk9IjY4Ljg5IiBmaWxsPSJoc2xhKDExOS43NjMwMTUzNDA3MTkxNSwgNzAlLCA4MCUsIDAuMjE5Nzg5MjkyNTc5MzA1NjYpIiBmaWx0ZXI9ImJsdXIoNDguMzQ1NTgzMTAzOTIwMjNweCkiIG9wYWNpdHk9Ii4yMTk4Ii8+CiA8cmVjdCB0cmFuc2Zvcm09InJvdGF0ZSgyNDQuNSA4NTkuNiAxNTA4KSIgeD0iNzkxLjkiIHk9IjE0NDAiIHdpZHRoPSIxMzUuNCIgaGVpZ2h0PSIxMzUuNCIgcng9IjMzLjg0IiBmaWxsPSJoc2xhKDg3LjM0MTM1NTIzNDE5NTY2LCA3MCUsIDgwJSwgMC4zODkxMzIyODI0NzM1MDQ4NCkiIGZpbHRlcj0iYmx1cigxMS4wNjI2ODQ2Mjk1NjE1OHB4KSIgb3BhY2l0eT0iLjM4OTEiLz4KIDxyZWN0IHRyYW5zZm9ybT0icm90YXRlKDE4OC41IDE0NzAgMzYwLjMpIiB4PSIxNDQzIiB5PSIzMzMiIHdpZHRoPSI1NC42MiIgaGVpZ2h0PSI1NC42MiIgcng9IjEzLjY1IiBmaWxsPSJoc2xhKDMxMi4yNjU5NDIxNjIyNjgzLCA3MCUsIDgwJSwgMC4yMjcxOTQwNTkyMjM3MjMxKSIgZmlsdGVyPSJibHVyKDQzLjI1MDY0MDg1MDEzMzEyNHB4KSIgb3BhY2l0eT0iLjIyNzIiLz4KIDxyZWN0IHRyYW5zZm9ybT0icm90YXRlKDM1LjM1IDExODMgMTcxNCkiIHg9IjExMjMiIHk9IjE2NTMiIHdpZHRoPSIxMjEuMSIgaGVpZ2h0PSIxMjEuMSIgcng9IjMwLjI3IiBmaWxsPSJoc2xhKDE0MS45NTk4MTA0NjUyODQ4MiwgNzAlLCA4MCUsIDAuMzU1NjIzNzg3OTkyMjMxNikiIGZpbHRlcj0iYmx1cigxNC41Mjk1NzU3MTQ2NDM1NjJweCkiIG9wYWNpdHk9Ii4zNTU2Ii8+CiA8ZWxsaXBzZSB0cmFuc2Zvcm09InJvdGF0ZSgxMzQuOSAyMzgwIDI1Ni40KSIgY3g9IjIzODAiIGN5PSIyNTYuNCIgcng9Ijg4LjA3IiByeT0iNDQuMDMiIGZpbGw9ImhzbGEoMTE4LjM0NTU0Nzk3NTk0MjA3LCA3MCUsIDgwJSwgMC4yNDcxMzc1Mzk1NDMwNDI4KSIgZmlsdGVyPSJibHVyKDM5LjM5MjI0MTEwNzE2NDI1cHgpIiBvcGFjaXR5PSIuMjQ3MSIvPgogPGVsbGlwc2UgdHJhbnNmb3JtPSJyb3RhdGUoMTgyLjkgMTM0MSA4MjkuNSkiIGN4PSIxMzQxIiBjeT0iODI5LjUiIHJ4PSI1Mi40NyIgcnk9IjI2LjI0IiBmaWxsPSJoc2xhKDM1MS42MDAyNTUyODE2NjkyNiwgNzAlLCA4MCUsIDAuMjkzOTg1NjUxNDczNzIwNzQpIiBmaWx0ZXI9ImJsdXIoMTYuNzcxNjIxNDY0NzAxMjJweCkiIG9wYWNpdHk9Ii4yOTQiLz4KIDxlbGxpcHNlIHRyYW5zZm9ybT0icm90YXRlKC03NS40NyAyMjcyIDgyOS45KSIgY3g9IjIyNzIiIGN5PSI4MjkuOSIgcng9IjU1LjY0IiByeT0iMjcuODIiIGZpbGw9ImhzbGEoMjI0Ljc5Njg1MTY0NjI1ODc0LCA3MCUsIDgwJSwgMC4yODYyOTM5NTI1NDY1NzI2KSIgZmlsdGVyPSJibHVyKDMzLjI4Nzc3NzU3NjczNjMxcHgpIiBvcGFjaXR5PSIuMjg2MyIvPgogPHJlY3QgdHJhbnNmb3JtPSJyb3RhdGUoMTMuMDggMTgzNCAxMDk2KSIgeD0iMTgxOSIgeT0iMTA4MiIgd2lkdGg9IjI5LjgiIGhlaWdodD0iMjkuOCIgcng9IjcuNDUiIGZpbGw9ImhzbGEoNDIuNjU0NzE5NTMxNzAzODc2LCA3MCUsIDgwJSwgMC4yNDU1NzExNDkzNDMwOTAwMikiIGZpbHRlcj0iYmx1cig0LjgzMjE5MTY4Mzk0MzM2NnB4KSIgb3BhY2l0eT0iLjI0NTYiLz4KIDxlbGxpcHNlIHRyYW5zZm9ybT0icm90YXRlKC02Ny44NCAxMDQ5IDI4NC4zKSIgY3g9IjEwNDkiIGN5PSIyODQuMyIgcng9IjExMC4yIiByeT0iNTUuMTEiIGZpbGw9ImhzbGEoMzMyLjM3MDc0OTA5NDY3NDUsIDcwJSwgODAlLCAwLjI3NjQ4Mjc5MDEwNzcyNzgpIiBmaWx0ZXI9ImJsdXIoMzcuNTExNjgxMzU1NzgyNjZweCkiIG9wYWNpdHk9Ii4yNzY1Ii8+CiA8Y2lyY2xlIHRyYW5zZm9ybT0icm90YXRlKC00Mi4xNiAyMjQ1IDQ4My40KSIgY3g9IjIyNDUiIGN5PSI0ODMuNCIgcj0iNjIuNDQiIGZpbGw9ImhzbGEoMzIyLjI4NjYxNjg0NzQyNDk3LCA3MCUsIDgwJSwgMC4yNDEwNzI2OTk4OTM2OTA4KSIgZmlsdGVyPSJibHVyKDQ0LjgwODA0NzE4NzE3ODM2cHgpIiBvcGFjaXR5PSIuMjQxMSIvPgogPHJlY3QgdHJhbnNmb3JtPSJyb3RhdGUoLTMxLjk1IDIwMzYgNTQxLjcpIiB4PSIxOTY0IiB5PSI0NjguOSIgd2lkdGg9IjE0NS43IiBoZWlnaHQ9IjE0NS43IiByeD0iMzYuNDMiIGZpbGw9ImhzbGEoMTQ5Ljk1NDE2MjI5MzQ0NzksIDcwJSwgODAlLCAwLjI5NTI1Nzg0NTYxMTg5NDEpIiBmaWx0ZXI9ImJsdXIoMTguMjE1NjYyNTI2NjA2NjhweCkiIG9wYWNpdHk9Ii4yOTUzIi8+CiA8ZWxsaXBzZSB0cmFuc2Zvcm09InJvdGF0ZSg4NC4zNCAxNzQ1IDU2My40KSIgY3g9IjE3NDUiIGN5PSI1NjMuNCIgcng9Ijc3Ljk3IiByeT0iMzguOTgiIGZpbGw9ImhzbGEoMTMyLjE4MTIyMzMxNjM2NjI3LCA3MCUsIDgwJSwgMC4yNzExNTA5MTkwNzc1MjgzNikiIGZpbHRlcj0iYmx1cig0Mi40NTk2Mjg5MTkxMTI4NjZweCkiIG9wYWNpdHk9Ii4yNzEyIi8+CiA8cmVjdCB0cmFuc2Zvcm09InJvdGF0ZSgxOTYuNCAyODA5IDIzNy4zKSIgeD0iMjc5NCIgeT0iMjIxLjgiIHdpZHRoPSIzMC45NCIgaGVpZ2h0PSIzMC45NCIgcng9IjcuNzM1IiBmaWxsPSJoc2xhKDIyMC41MzUyODA0ODM2Njg2MywgNzAlLCA4MCUsIDAuMzQyNzkyMzUzMzI0MzkyNCkiIGZpbHRlcj0iYmx1cig0Ny42NzE3MjE4OTk4ODk1OXB4KSIgb3BhY2l0eT0iLjM0MjgiLz4KIDxyZWN0IHRyYW5zZm9ybT0icm90YXRlKDc2Ljc2IDEzOTQgMTUyOSkiIHg9IjEzNTIiIHk9IjE0ODciIHdpZHRoPSI4NC43MSIgaGVpZ2h0PSI4NC43MSIgcng9IjIxLjE4IiBmaWxsPSJoc2xhKDc1Ljc2OTM3MjQ2NDgyNjMyLCA3MCUsIDgwJSwgMC4zMDcyNTgyMTM3Mzk1MjM0NCkiIGZpbHRlcj0iYmx1cigxNy42NjkzMDkwMTE0NDQ4MzhweCkiIG9wYWNpdHk9Ii4zMDczIi8+CiA8cmVjdCB0cmFuc2Zvcm09InJvdGF0ZSgzMy4wMiAyNjA4IDIzMS44KSIgeD0iMjU2MSIgeT0iMTg0LjQiIHdpZHRoPSI5NC42NCIgaGVpZ2h0PSI5NC42NCIgcng9IjIzLjY2IiBmaWxsPSJoc2xhKDMxNy44MTk4NDM0MDg2MDk4LCA3MCUsIDgwJSwgMC4xMDU2ODEyNjc4NzQ1NDk0KSIgZmlsdGVyPSJibHVyKDE4LjI3OTAxNzQwMjg1ODE2MnB4KSIgb3BhY2l0eT0iLjEwNTciLz4KIDxjaXJjbGUgdHJhbnNmb3JtPSJyb3RhdGUoNTcuNTIgOTk2LjkgMTY2OCkiIGN4PSI5OTYuOSIgY3k9IjE2NjgiIHI9IjM5LjkzIiBmaWxsPSJoc2xhKDIzNC4yNjE4MDMzNTg0MDY2LCA3MCUsIDgwJSwgMC4xNDc2NTgxOTMwODI4NTA0KSIgZmlsdGVyPSJibHVyKDIuODA1MTk0MzQ4MDc4NzZweCkiIG9wYWNpdHk9Ii4xNDc3Ii8+CiA8Y2lyY2xlIHRyYW5zZm9ybT0icm90YXRlKDE2MC4zIDI3OTYgMTQ5LjUpIiBjeD0iMjc5NiIgY3k9IjE0OS41IiByPSI0Ny42IiBmaWxsPSJoc2xhKDcwLjI3NzY4MDk4NzQ4MDE3LCA3MCUsIDgwJSwgMC4xMjk2MzQ2NTYwMjA0NDMxNikiIGZpbHRlcj0iYmx1cigxNS44MTQ1ODA4MzgxMDcxMzNweCkiIG9wYWNpdHk9Ii4xMjk2Ii8+CiA8cmVjdCB0cmFuc2Zvcm09InJvdGF0ZSgyMy40NCA5NjcuOSAxMjkwKSIgeD0iOTM5LjMiIHk9IjEyNjIiIHdpZHRoPSI1Ny4xNyIgaGVpZ2h0PSI1Ny4xNyIgcng9IjE0LjI5IiBmaWxsPSJoc2xhKDcuNDAyMzYzNTE4MDc2OTMxLCA3MCUsIDgwJSwgMC4zMTg2NDczMDM1MDgwMDQyKSIgZmlsdGVyPSJibHVyKDE1LjE4OTYxNjkwNjU5MTg0NnB4KSIgb3BhY2l0eT0iLjMxODYiLz4KIDxyZWN0IHRyYW5zZm9ybT0icm90YXRlKDI2Ni45IDI1MjQgMTU4NSkiIHg9IjI0NjYiIHk9IjE1MjYiIHdpZHRoPSIxMTYuNSIgaGVpZ2h0PSIxMTYuNSIgcng9IjI5LjEzIiBmaWxsPSJoc2xhKDI3Ny4zMTY1Nzg0OTAyNzc4MywgNzAlLCA4MCUsIDAuMTI4NjA3MTUxOTUxMTYwMTgpIiBmaWx0ZXI9ImJsdXIoNDYuNTY5OTA5NzE5NTc5OTFweCkiIG9wYWNpdHk9Ii4xMjg2Ii8+CiA8ZWxsaXBzZSB0cmFuc2Zvcm09InJvdGF0ZSg3My45IDE4MDUgMTA3NikiIGN4PSIxODA1IiBjeT0iMTA3NiIgcng9IjExNS45IiByeT0iNTcuOTQiIGZpbGw9ImhzbGEoMTIwLjQ4NjkzOTM2NjI5NzcsIDcwJSwgODAlLCAwLjMyNzE5NjA3MjE1ODAzNjAzKSIgZmlsdGVyPSJibHVyKDM2Ljk2Njk4MzMyMzYxNTI5cHgpIiBvcGFjaXR5PSIuMzI3MiIvPgogPGVsbGlwc2UgdHJhbnNmb3JtPSJyb3RhdGUoMjI5LjggMTk3NiA4OTMuNikiIGN4PSIxOTc2IiBjeT0iODkzLjYiIHJ4PSIxMDMuOCIgcnk9IjUxLjkxIiBmaWxsPSJoc2xhKDIxNy4zMzUxNTM5MTMyMTM2NSwgNzAlLCA4MCUsIDAuMzI0ODk2MDQ0NzAyMTkwMjUpIiBmaWx0ZXI9ImJsdXIoMi45MDA1ODAwNzAxNTY5OTM3cHgpIiBvcGFjaXR5PSIuMzI0OSIvPgogPGNpcmNsZSB0cmFuc2Zvcm09InJvdGF0ZSgxNC41OCAyNzU4IDgwNi4zKSIgY3g9IjI3NTgiIGN5PSI4MDYuMyIgcj0iNjUuNzIiIGZpbGw9ImhzbGEoMjYwLjU1MzcwNTYyMjIyMTIzLCA3MCUsIDgwJSwgMC4yNTg3ODgzNzI3MTMzODI1KSIgZmlsdGVyPSJibHVyKDQwLjM2MTYyNDkzOTM1NTY2NHB4KSIgb3BhY2l0eT0iLjI1ODgiLz4KIDxlbGxpcHNlIHRyYW5zZm9ybT0icm90YXRlKDE0MC4zIDI3MDcgMTM4OCkiIGN4PSIyNzA3IiBjeT0iMTM4OCIgcng9Ijg2LjQ1IiByeT0iNDMuMjMiIGZpbGw9ImhzbGEoMTc1LjQ4NjU2NDc3NzI1MTc3LCA3MCUsIDgwJSwgMC4xNTc2OTI5MTgxNDE5MDE3MykiIGZpbHRlcj0iYmx1cigxNC4zNTI5Mzg2ODk5NjEwMjVweCkiIG9wYWNpdHk9Ii4xNTc3Ii8+CiA8Y2lyY2xlIHRyYW5zZm9ybT0icm90YXRlKDcuMjc2IDgwMS45IDExMjQpIiBjeD0iODAxLjkiIGN5PSIxMTI0IiByPSIyMS40MSIgZmlsbD0iaHNsYSgxMTUuMDA3Nzk4MzU5MzczNjEsIDcwJSwgODAlLCAwLjI1NzU2ODM0MTE1ODUxODM0KSIgZmlsdGVyPSJibHVyKDIyLjkyNDMwMjUxNDQ2NjQ1NHB4KSIgb3BhY2l0eT0iLjI1NzYiLz4KIDxlbGxpcHNlIHRyYW5zZm9ybT0icm90YXRlKC02OS42OCA1NjYgNDUyLjUpIiBjeD0iNTY2IiBjeT0iNDUyLjUiIHJ4PSIxMTIuNiIgcnk9IjU2LjMyIiBmaWxsPSJoc2xhKDEzNy45NDgwNzYyNzAzNjQ0MiwgNzAlLCA4MCUsIDAuMTIxMjQ5NjIyMzU4NTk3MzUpIiBmaWx0ZXI9ImJsdXIoNDMuOTcxMDM5MDg4OTkyMDY1cHgpIiBvcGFjaXR5PSIuMTIxMiIvPgogPGNpcmNsZSB0cmFuc2Zvcm09InJvdGF0ZSgtMzAuMzIgMjY0MyAxMjgwKSIgY3g9IjI2NDMiIGN5PSIxMjgwIiByPSI0Mi40MyIgZmlsbD0iaHNsYSgxNTYuODUxNDAzODcwNTM0MjMsIDcwJSwgODAlLCAwLjM1NDE5NTE5NDAwMzI1ODcpIiBmaWx0ZXI9ImJsdXIoNDMuOTY2MDEwODE1NjM1NzM0cHgpIiBvcGFjaXR5PSIuMzU0MiIvPgogPGNpcmNsZSB0cmFuc2Zvcm09InJvdGF0ZSgtNDguNDEgNzAyLjMgODYwLjYpIiBjeD0iNzAyLjMiIGN5PSI4NjAuNiIgcj0iMTIuMDkiIGZpbGw9ImhzbGEoMjc3LjcyNzMxNzE5Mzc1ODcsIDcwJSwgODAlLCAwLjI1NzYyMDMxMjcxNjg0MDcpIiBmaWx0ZXI9ImJsdXIoNDguNDE4OTYxMDA3MzA2MTVweCkiIG9wYWNpdHk9Ii4yNTc2Ii8+CiA8cmVjdCB0cmFuc2Zvcm09InJvdGF0ZSgxOTcuNyAyNTIzIDE2NjUpIiB4PSIyNDY4IiB5PSIxNjExIiB3aWR0aD0iMTA5LjIiIGhlaWdodD0iMTA5LjIiIHJ4PSIyNy4yOSIgZmlsbD0iaHNsYSgyMS42Mjg0Njg5MDQ3NjU2NTgsIDcwJSwgODAlLCAwLjI1NjY5NTcyNzU2MTQ5Nzk0KSIgZmlsdGVyPSJibHVyKDQwLjQ4MDM2ODQzNDgyMzExcHgpIiBvcGFjaXR5PSIuMjU2NyIvPgogPGVsbGlwc2UgdHJhbnNmb3JtPSJyb3RhdGUoMjAyLjcgMjIxOCA2NDEuNikiIGN4PSIyMjE4IiBjeT0iNjQxLjYiIHJ4PSIxMDAuNCIgcnk9IjUwLjIyIiBmaWxsPSJoc2xhKDQ0LjEwMjcwNzM3MDA2Mjg0LCA3MCUsIDgwJSwgMC4xMDk3NDk1MjYzMTgxNjgzNCkiIGZpbHRlcj0iYmx1cigxNS4xNTM3Mjc3NDUwOTAwMzRweCkiIG9wYWNpdHk9Ii4xMDk3Ii8+CiA8ZWxsaXBzZSB0cmFuc2Zvcm09InJvdGF0ZSgyMTQuNSA5NTguMyA1NzQuNykiIGN4PSI5NTguMyIgY3k9IjU3NC43IiByeD0iNjQuNDEiIHJ5PSIzMi4yMSIgZmlsbD0iaHNsYSgzNDEuMzE3NzExMDYwMzkxNTYsIDcwJSwgODAlLCAwLjE2NzYzNDQ0NDI4NjAzNTcpIiBmaWx0ZXI9ImJsdXIoMzQuMDY0MDc0ODU3MTE5MTVweCkiIG9wYWNpdHk9Ii4xNjc2Ii8+CiA8ZWxsaXBzZSB0cmFuc2Zvcm09InJvdGF0ZSgxODguMiAyNDYxIDE4NS43KSIgY3g9IjI0NjEiIGN5PSIxODUuNyIgcng9IjI2LjQ4IiByeT0iMTMuMjQiIGZpbGw9ImhzbGEoMzU4Ljg2NjQzNzc2MzAxMTcsIDcwJSwgODAlLCAwLjE4NjIwMTE5NzIzNTcxMDI3KSIgZmlsdGVyPSJibHVyKDEzLjYzMDMzNjI0MzQ0OTUxNXB4KSIgb3BhY2l0eT0iLjE4NjIiLz4KIDxyZWN0IHRyYW5zZm9ybT0icm90YXRlKDE3My4zIDE0OS4yIDIwOS4yKSIgeD0iOTYuOTIiIHk9IjE1Ni45IiB3aWR0aD0iMTA0LjciIGhlaWdodD0iMTA0LjciIHJ4PSIyNi4xNiIgZmlsbD0iaHNsYSgxMTAuNjIxMDkxMTA0ODQ0OTEsIDcwJSwgODAlLCAwLjI0OTM4MzY5NjgxMjc4OTc0KSIgZmlsdGVyPSJibHVyKDQzLjQzNzUzMTA1MTM5MjU4cHgpIiBvcGFjaXR5PSIuMjQ5NCIvPgogPGVsbGlwc2UgdHJhbnNmb3JtPSJyb3RhdGUoLTE2LjA4IDI0ODEgNTk2LjIpIiBjeD0iMjQ4MSIgY3k9IjU5Ni4yIiByeD0iMTMyLjYiIHJ5PSI2Ni4zMiIgZmlsbD0iaHNsYSgxMDUuODU3NjkyOTU2Mjc4MiwgNzAlLCA4MCUsIDAuMzc4OTAzMzQxNDc2MTkwMikiIGZpbHRlcj0iYmx1cig0OC4wODM0NDA0OTc1OTE0NTRweCkiIG9wYWNpdHk9Ii4zNzg5Ii8+CiA8ZWxsaXBzZSB0cmFuc2Zvcm09InJvdGF0ZSgxMzMuNSAyNzM0IDE2NzYpIiBjeD0iMjczNCIgY3k9IjE2NzYiIHJ4PSIzNi40NyIgcnk9IjE4LjI0IiBmaWxsPSJoc2xhKDc0LjcwNTQ2ODIyMDQ1OTA0LCA3MCUsIDgwJSwgMC4yNjcyNjc1MDE3OTEwMzM3NikiIGZpbHRlcj0iYmx1cig2LjM4OTQ1NzYxMTA5Mjc4cHgpIiBvcGFjaXR5PSIuMjY3MyIvPgogPGVsbGlwc2UgdHJhbnNmb3JtPSJyb3RhdGUoMTM3LjMgMTE0NyAxNjkyKSIgY3g9IjExNDciIGN5PSIxNjkyIiByeD0iMTE0LjMiIHJ5PSI1Ny4xNCIgZmlsbD0iaHNsYSgzMDkuMjczMjY5MTY1NjM4NywgNzAlLCA4MCUsIDAuMTYxMDM1NDY0MDg0MzQyOSkiIGZpbHRlcj0iYmx1cig0OS4zMTc1ODU3MzU3OTM0M3B4KSIgb3BhY2l0eT0iLjE2MSIvPgogPGNpcmNsZSB0cmFuc2Zvcm09InJvdGF0ZSg2NS44IDEwODAgMjMyLjcpIiBjeD0iMTA4MCIgY3k9IjIzMi43IiByPSI0MS45NSIgZmlsbD0iaHNsYSgwLjkxOTg2MTI1ODA4MzU5NjMsIDcwJSwgODAlLCAwLjI4MTcwNTE4NDg0NTExNzAzKSIgZmlsdGVyPSJibHVyKDEuNTk1OTY0NTM5NjMxMTc4M3B4KSIgb3BhY2l0eT0iLjI4MTciLz4KIDxyZWN0IHRyYW5zZm9ybT0icm90YXRlKDE1MC45IDIwNTcgMzc2LjQpIiB4PSIyMDM5IiB5PSIzNTguOCIgd2lkdGg9IjM1LjIyIiBoZWlnaHQ9IjM1LjIyIiByeD0iOC44MDQiIGZpbGw9ImhzbGEoMTI0LjM5OTc1NzMzNjY3NjE1LCA3MCUsIDgwJSwgMC4yMDI5NjkxMjg2NzE1NTk1MykiIGZpbHRlcj0iYmx1cigyNi41MDgzNDEwNDEzNzE0M3B4KSIgb3BhY2l0eT0iLjIwMyIvPgogPGVsbGlwc2UgdHJhbnNmb3JtPSJyb3RhdGUoLTMuNjU0IDIwNDQgODQ5LjYpIiBjeD0iMjA0NCIgY3k9Ijg0OS42IiByeD0iNDguODIiIHJ5PSIyNC40MSIgZmlsbD0iaHNsYSgzNTUuOTU3MTc5MzY0OTQ0NzUsIDcwJSwgODAlLCAwLjE1Mzc4Nzk0MDMwOTEwNjEpIiBmaWx0ZXI9ImJsdXIoNDQuMzM0OTc5NDY4NzQ4MjRweCkiIG9wYWNpdHk9Ii4xNTM4Ii8+CiA8cmVjdCB0cmFuc2Zvcm09InJvdGF0ZSgtNC40MzEgMjIyLjIgMTU2MykiIHg9IjE1NS41IiB5PSIxNDk3IiB3aWR0aD0iMTMzLjQiIGhlaWdodD0iMTMzLjQiIHJ4PSIzMy4zNiIgZmlsbD0iaHNsYSgxODIuNjcyMzA3MDc1MDAzNzQsIDcwJSwgODAlLCAwLjE3NDc2MDg2NDQ5OTU5MDc3KSIgZmlsdGVyPSJibHVyKDMuNjI3ODE0MTEzMjkwMjUxcHgpIiBvcGFjaXR5PSIuMTc0OCIvPgogPGNpcmNsZSB0cmFuc2Zvcm09InJvdGF0ZSgyMTMuOSA1ODMuMiA5NDQuOCkiIGN4PSI1ODMuMiIgY3k9Ijk0NC44IiByPSI2OC4xOSIgZmlsbD0iaHNsYSgxOTUuNjc5MTQ5NzU4ODgzMjgsIDcwJSwgODAlLCAwLjI4NTg4MDIzNzg0NzA2NjMpIiBmaWx0ZXI9ImJsdXIoMzguMTE2MTg0MjM2NTE2MzlweCkiIG9wYWNpdHk9Ii4yODU5Ii8+CiA8cmVjdCB0cmFuc2Zvcm09InJvdGF0ZSgtMzUuNTggMTQ4NiAxMzQzKSIgeD0iMTQ0OSIgeT0iMTMwNiIgd2lkdGg9Ijc0LjQ0IiBoZWlnaHQ9Ijc0LjQ0IiByeD0iMTguNjEiIGZpbGw9ImhzbGEoMjMyLjg4MTQwODIzODE5Mjg4LCA3MCUsIDgwJSwgMC4zNzk0OTUzNjM1NzcwODYxMykiIGZpbHRlcj0iYmx1cigzNS42MTQ1OTUyNjUyMDIyNHB4KSIgb3BhY2l0eT0iLjM3OTUiLz4KIDxyZWN0IHRyYW5zZm9ybT0icm90YXRlKDQ3LjUzIDE4NjAgMzQwLjUpIiB4PSIxODAxIiB5PSIyODIiIHdpZHRoPSIxMTciIGhlaWdodD0iMTE3IiByeD0iMjkuMjUiIGZpbGw9ImhzbGEoMTUwLjY4NzI0MDEzMDg5NjczLCA3MCUsIDgwJSwgMC4yMjY0MzcyODQxOTU5Njg2NSkiIGZpbHRlcj0iYmx1cigzNi4wNjg2MjU5NDIzODE3NnB4KSIgb3BhY2l0eT0iLjIyNjQiLz4KIDxlbGxpcHNlIHRyYW5zZm9ybT0icm90YXRlKDExNCAyODU4IDE3NDEpIiBjeD0iMjg1OCIgY3k9IjE3NDEiIHJ4PSIxNTAiIHJ5PSI3NSIgZmlsbD0iaHNsYSgyMTIuODQyMjMzODMxMzUyNTYsIDcwJSwgODAlLCAwLjEzODUxODM1MDgwNDY5NzA0KSIgZmlsdGVyPSJibHVyKDI2Ljg2Nzg2NjU0NDQ2Nzg2MnB4KSIgb3BhY2l0eT0iLjEzODUiLz4KIDxjaXJjbGUgdHJhbnNmb3JtPSJyb3RhdGUoODYuOTYgOTQ1LjggNjUwLjUpIiBjeD0iOTQ1LjgiIGN5PSI2NTAuNSIgcj0iNjguNjkiIGZpbGw9ImhzbGEoMjAyLjE1MjA2MTI5NzgyMjc0LCA3MCUsIDgwJSwgMC4zNTk4NDA1MjExMTc1OTA4KSIgZmlsdGVyPSJibHVyKDQ2LjA0NDc4ODU5MjQyNDQzcHgpIiBvcGFjaXR5PSIuMzU5OCIvPgogPGNpcmNsZSB0cmFuc2Zvcm09InJvdGF0ZSgtNDYuMjggMTg2MyAxNzE3KSIgY3g9IjE4NjMiIGN5PSIxNzE3IiByPSIyMi43NCIgZmlsbD0iaHNsYSgxNS4yNzc2ODk4NTg2MjkzNDQsIDcwJSwgODAlLCAwLjMyMDk4MzA2MzQwNTE4NzU2KSIgZmlsdGVyPSJibHVyKDE0LjE4MDgwNTc2MzA0MDcyMnB4KSIgb3BhY2l0eT0iLjMyMSIvPgogPGVsbGlwc2UgdHJhbnNmb3JtPSJyb3RhdGUoMjY2LjkgODAyLjcgMTE4NSkiIGN4PSI4MDIuNyIgY3k9IjExODUiIHJ4PSI3Mi40MiIgcnk9IjM2LjIxIiBmaWxsPSJoc2xhKDE2MS45NzQ3MDA3NDkxOTgxMiwgNzAlLCA4MCUsIDAuMjkxMDU4NTQ2ODUzODc0NCkiIGZpbHRlcj0iYmx1cigzMy4xMTc4NTc4NjI0OTA5NjVweCkiIG9wYWNpdHk9Ii4yOTExIi8+CiA8Y2lyY2xlIHRyYW5zZm9ybT0icm90YXRlKDEwLjQgMjA5LjcgNDcyKSIgY3g9IjIwOS43IiBjeT0iNDcyIiByPSI0NC4yIiBmaWxsPSJoc2xhKDMuODkwNjA1Mzc1NTYzMzAzLCA3MCUsIDgwJSwgMC4xNzkwNDA4NjMxNDUxNTkxNikiIGZpbHRlcj0iYmx1cigxOS4yMDgwMzQwOTE0NTY0MTVweCkiIG9wYWNpdHk9Ii4xNzkiLz4KIDxjaXJjbGUgdHJhbnNmb3JtPSJyb3RhdGUoLTQzLjI1IDI4NzggMTQ0OSkiIGN4PSIyODc4IiBjeT0iMTQ0OSIgcj0iNjMuNTciIGZpbGw9ImhzbGEoMTc1Ljk3NzQwNTU4NzIzOTUsIDcwJSwgODAlLCAwLjI2NjU1ODA2NDY2MzM5NDI3KSIgZmlsdGVyPSJibHVyKDI2LjY3NDgzOTMwNDQ3MDA3M3B4KSIgb3BhY2l0eT0iLjI2NjYiLz4KIDxyZWN0IHRyYW5zZm9ybT0icm90YXRlKDM5LjQ5IDE4NDUgMTM5OSkiIHg9IjE4MDIiIHk9IjEzNTYiIHdpZHRoPSI4Ni42OCIgaGVpZ2h0PSI4Ni42OCIgcng9IjIxLjY3IiBmaWxsPSJoc2xhKDc3LjY0NzEzMjk0NTI0MDc4LCA3MCUsIDgwJSwgMC4yNTU3OTQ4MDE2NjYxNTcyKSIgZmlsdGVyPSJibHVyKDExLjcyNzQyMjgxMzkzMDM3MXB4KSIgb3BhY2l0eT0iLjI1NTgiLz4KIDxlbGxpcHNlIHRyYW5zZm9ybT0icm90YXRlKDIxMC41IDEwNDEgMTU4NSkiIGN4PSIxMDQxIiBjeT0iMTU4NSIgcng9IjM2LjM0IiByeT0iMTguMTciIGZpbGw9ImhzbGEoMjUyLjQwNzI0ODE5ODM3MzAzLCA3MCUsIDgwJSwgMC4xMDE0MzU3MjAyNjIzMzY5NSkiIGZpbHRlcj0iYmx1cig0MS4xNDcyODI4MDYxOTEzN3B4KSIgb3BhY2l0eT0iLjEwMTQiLz4KIDxyZWN0IHRyYW5zZm9ybT0icm90YXRlKDEzMC42IDE5MTQgMTMxNikiIHg9IjE4NzIiIHk9IjEyNzQiIHdpZHRoPSI4My43NCIgaGVpZ2h0PSI4My43NCIgcng9IjIwLjkzIiBmaWxsPSJoc2xhKDE3Ni43NDIzNjQ2Mjc1NTQ4OCwgNzAlLCA4MCUsIDAuMjUxMDI2NTkzNTg2ODMzNikiIGZpbHRlcj0iYmx1cigxNC44NzEyNjc4NjA1MzYwMzdweCkiIG9wYWNpdHk9Ii4yNTEiLz4KIDxyZWN0IHRyYW5zZm9ybT0icm90YXRlKC01Mi41IDcxOS45IDY0NCkiIHg9IjY4MS40IiB5PSI2MDUuNSIgd2lkdGg9Ijc2LjkiIGhlaWdodD0iNzYuOSIgcng9IjE5LjIyIiBmaWxsPSJoc2xhKDI5Mi4zODU5NDUwOTA3ODcyLCA3MCUsIDgwJSwgMC4xODU1NzA4NDY1NDk0NDkyMikiIGZpbHRlcj0iYmx1cig0Mi4zNjcwMjM5NTU1MDkxNzVweCkiIG9wYWNpdHk9Ii4xODU2Ii8+CiA8Y2lyY2xlIHRyYW5zZm9ybT0icm90YXRlKDY5LjM1IDUyMi43IDU1My4xKSIgY3g9IjUyMi43IiBjeT0iNTUzLjEiIHI9IjYyLjg1IiBmaWxsPSJoc2xhKDMyOS4xMjM5NTQ3ODY5NjA1NSwgNzAlLCA4MCUsIDAuMzUwMTUzODY3MzU5MjE3MykiIGZpbHRlcj0iYmx1cig0MC44NzUzODYzNTQ3MTE4MXB4KSIgb3BhY2l0eT0iLjM1MDIiLz4KIDxjaXJjbGUgdHJhbnNmb3JtPSJyb3RhdGUoMjMxLjkgMTYzMyAxNjgxKSIgY3g9IjE2MzMiIGN5PSIxNjgxIiByPSIyNi44NyIgZmlsbD0iaHNsYSgxNTguMTY0OTE0ODQ1MTY1MSwgNzAlLCA4MCUsIDAuMjE4ODMxOTIzMTg3NDU5MzcpIiBmaWx0ZXI9ImJsdXIoMjUuNzY3NDczNTYzNTY4NTkzcHgpIiBvcGFjaXR5PSIuMjE4OCIvPgogPGNpcmNsZSB0cmFuc2Zvcm09InJvdGF0ZSgxNjEuOSAxODMxIDMwOCkiIGN4PSIxODMxIiBjeT0iMzA4IiByPSIzMC40OSIgZmlsbD0iaHNsYSg1MC4wODY1MTgwODk2OTIwOSwgNzAlLCA4MCUsIDAuMjMwOTgxMzc2NDY0OTE2NCkiIGZpbHRlcj0iYmx1cig5LjQyMDM4OTU3ODE0MjQyNXB4KSIgb3BhY2l0eT0iLjIzMSIvPgogPGVsbGlwc2UgdHJhbnNmb3JtPSJyb3RhdGUoMTU1LjEgMzY3LjIgNzU2LjMpIiBjeD0iMzY3LjIiIGN5PSI3NTYuMyIgcng9IjczLjA3IiByeT0iMzYuNTQiIGZpbGw9ImhzbGEoMjQ2Ljc3NTY1NTcxNDgyMDQsIDcwJSwgODAlLCAwLjMyODQ1MzQxNTk0ODc4NzMpIiBmaWx0ZXI9ImJsdXIoMzIuMTA1MjkzNTEwODkyODY0cHgpIiBvcGFjaXR5PSIuMzI4NSIvPgogPGNpcmNsZSB0cmFuc2Zvcm09InJvdGF0ZSg4My4wMiAyNzgwIDE3ODgpIiBjeD0iMjc4MCIgY3k9IjE3ODgiIHI9IjM2LjU4IiBmaWxsPSJoc2xhKDI1NC43MTA2MDk3NzMyNTA3MiwgNzAlLCA4MCUsIDAuMTYyMDMyNzk5MDk5NDE4MjgpIiBmaWx0ZXI9ImJsdXIoMzQuNTAzMDU1NzQzMjQ2MjhweCkiIG9wYWNpdHk9Ii4xNjIiLz4KIDxyZWN0IHRyYW5zZm9ybT0icm90YXRlKDE3OC42IDcxNC43IDI5MS45KSIgeD0iNjg2LjkiIHk9IjI2NC4xIiB3aWR0aD0iNTUuNTUiIGhlaWdodD0iNTUuNTUiIHJ4PSIxMy44OSIgZmlsbD0iaHNsYSgzMzIuMzk5MzM0MDg0MzgyOTMsIDcwJSwgODAlLCAwLjI5MDIzODYwMzEzMzczNTk1KSIgZmlsdGVyPSJibHVyKDIuNDI2NjYyMDQwOTEzMzk2NXB4KSIgb3BhY2l0eT0iLjI5MDIiLz4KIDxlbGxpcHNlIHRyYW5zZm9ybT0icm90YXRlKDcxLjE3IDE0MzEgMTM3OCkiIGN4PSIxNDMxIiBjeT0iMTM3OCIgcng9IjExNC40IiByeT0iNTcuMiIgZmlsbD0iaHNsYSgyMjkuNTYzOTc4Njc4NTk4MjMsIDcwJSwgODAlLCAwLjI4MzY5OTYwMDA0NzEzMTMpIiBmaWx0ZXI9ImJsdXIoMzcuNDU1NjU0Mzc2MjYxNTJweCkiIG9wYWNpdHk9Ii4yODM3Ii8+CiA8ZWxsaXBzZSB0cmFuc2Zvcm09InJvdGF0ZSgyNDguNyA5NjUuNSAxMDkwKSIgY3g9Ijk2NS41IiBjeT0iMTA5MCIgcng9Ijg4LjA2IiByeT0iNDQuMDMiIGZpbGw9ImhzbGEoMTU5LjUwNjcyMTUyMTkxOTQ3LCA3MCUsIDgwJSwgMC4zNTU2MzkxNDc2OTUzOTEzKSIgZmlsdGVyPSJibHVyKDIwLjY5ODk2NDcwNTI5MzU4N3B4KSIgb3BhY2l0eT0iLjM1NTYiLz4KIDxjaXJjbGUgdHJhbnNmb3JtPSJyb3RhdGUoNDUuOTEgOTkyLjQgMTY3MSkiIGN4PSI5OTIuNCIgY3k9IjE2NzEiIHI9IjI2LjI5IiBmaWxsPSJoc2xhKDM2LjAyNDcyMjIyMTY5ODc5NSwgNzAlLCA4MCUsIDAuMTkyOTAyOTE2NzY2NDI2MzUpIiBmaWx0ZXI9ImJsdXIoMzAuMTQ0OTkxNTkwMDkxNDg2cHgpIiBvcGFjaXR5PSIuMTkyOSIvPgogPHJlY3QgdHJhbnNmb3JtPSJyb3RhdGUoLTI4LjQzIDI0MjUgMTUyMCkiIHg9IjIzOTMiIHk9IjE0ODkiIHdpZHRoPSI2My4zMiIgaGVpZ2h0PSI2My4zMiIgcng9IjE1LjgzIiBmaWxsPSJoc2xhKDExMS43NTM4NDI0NDQ0MDY1MywgNzAlLCA4MCUsIDAuMjM2NzQ5Njc0OTEzMjQ2OTIpIiBmaWx0ZXI9ImJsdXIoMTEuMTc3MTE2NjYyODQ3MDA0cHgpIiBvcGFjaXR5PSIuMjM2NyIvPgogPGVsbGlwc2UgdHJhbnNmb3JtPSJyb3RhdGUoODIuNjIgNjMuNDIgMTMzOCkiIGN4PSI2My40MiIgY3k9IjEzMzgiIHJ4PSIxMjYuOSIgcnk9IjYzLjQ0IiBmaWxsPSJoc2xhKDEzMy4xMDA4MTE5NTU5MjgwNywgNzAlLCA4MCUsIDAuMTA2MzQyMDQzMTUzNTY5MjQpIiBmaWx0ZXI9ImJsdXIoNDIuMzIxMjkzMTYzMzEzMTY1cHgpIiBvcGFjaXR5PSIuMTA2MyIvPgogPGVsbGlwc2UgdHJhbnNmb3JtPSJyb3RhdGUoMTM5LjMgMjI4OCAxMzYyKSIgY3g9IjIyODgiIGN5PSIxMzYyIiByeD0iNTUuMDYiIHJ5PSIyNy41MyIgZmlsbD0iaHNsYSgxMC4wOTAxNjMwMTMxNzQ1NTMsIDcwJSwgODAlLCAwLjM5NjUzMDY4MjE5ODUxNjk1KSIgZmlsdGVyPSJibHVyKDcuMDIwMzU5MTMwMDYwOTZweCkiIG9wYWNpdHk9Ii4zOTY1Ii8+CiA8Y2lyY2xlIHRyYW5zZm9ybT0icm90YXRlKDIyNiAyMjU2IDEwMDEpIiBjeD0iMjI1NiIgY3k9IjEwMDEiIHI9IjQ3LjU0IiBmaWxsPSJoc2xhKDI4Ni40NjUzOTExNTIzMDM1LCA3MCUsIDgwJSwgMC4xMDYwMjc2NzAxMzQ0MzQyKSIgZmlsdGVyPSJibHVyKDEuMTI0Nzc0MDE5ODQ4MTIzOHB4KSIgb3BhY2l0eT0iLjEwNiIvPgogPGNpcmNsZSB0cmFuc2Zvcm09InJvdGF0ZSg5NC43OCAyNTAyIDc0MS42KSIgY3g9IjI1MDIiIGN5PSI3NDEuNiIgcj0iMzAuNTQiIGZpbGw9ImhzbGEoNDMuMjU2MTIwMjg1MTE2OTUsIDcwJSwgODAlLCAwLjM2MDA2MTQ0MjczOTA1NTgpIiBmaWx0ZXI9ImJsdXIoMy4xODc2MTY1NjA3Njg4OTFweCkiIG9wYWNpdHk9Ii4zNjAxIi8+CiA8ZWxsaXBzZSB0cmFuc2Zvcm09InJvdGF0ZSgxNzkuNCAxOTc2IDEzMjcpIiBjeD0iMTk3NiIgY3k9IjEzMjciIHJ4PSIxMjQuNiIgcnk9IjYyLjMyIiBmaWxsPSJoc2xhKDcwLjAzODE4MDU2MzE1MjAzLCA3MCUsIDgwJSwgMC4xNDc4ODE3NzcyMDc4Njc0NykiIGZpbHRlcj0iYmx1cigzNi4yMDEyNzI4NTkwODk0cHgpIiBvcGFjaXR5PSIuMTQ3OSIvPgogPHJlY3QgdHJhbnNmb3JtPSJyb3RhdGUoMTA5LjIgMjIxOSA1NDYpIiB4PSIyMTYyIiB5PSI0ODguNyIgd2lkdGg9IjExNC41IiBoZWlnaHQ9IjExNC41IiByeD0iMjguNjIiIGZpbGw9ImhzbGEoNTMuNTEwNjMzODg1ODk1MDEsIDcwJSwgODAlLCAwLjMxNzQ0OTk3MDgwMTEzNjIpIiBmaWx0ZXI9ImJsdXIoMTcuNzk1MzE3MTMxODQ0OTFweCkiIG9wYWNpdHk9Ii4zMTc0Ii8+CiA8Y2lyY2xlIHRyYW5zZm9ybT0icm90YXRlKDE2MyAxNTUuMyA2Ni40NCkiIGN4PSIxNTUuMyIgY3k9IjY2LjQ0IiByPSIzMS42IiBmaWxsPSJoc2xhKDM1OC4wMzI1MDE3MTk2MzY4LCA3MCUsIDgwJSwgMC4zMTkzMjkzNzMwNjM2MTYxKSIgZmlsdGVyPSJibHVyKDQwLjUxMzI3MDcxOTEzOTUwNnB4KSIgb3BhY2l0eT0iLjMxOTMiLz4KIDxyZWN0IHRyYW5zZm9ybT0icm90YXRlKC0xMi45NCAxNDM0IDE3MDIpIiB4PSIxMzkyIiB5PSIxNjU5IiB3aWR0aD0iODUuODciIGhlaWdodD0iODUuODciIHJ4PSIyMS40NyIgZmlsbD0iaHNsYSgyNDMuNjc1NjE5NTM5NDQ2LCA3MCUsIDgwJSwgMC4yNjg0NzYyODE1NzE0OTc4KSIgZmlsdGVyPSJibHVyKDI4LjcwMTQ2MjkwMjk4NTU2NXB4KSIgb3BhY2l0eT0iLjI2ODUiLz4KIDxlbGxpcHNlIHRyYW5zZm9ybT0icm90YXRlKDE3NC43IDIxNDEgNjkzLjMpIiBjeD0iMjE0MSIgY3k9IjY5My4zIiByeD0iNzIuNzciIHJ5PSIzNi4zOCIgZmlsbD0iaHNsYSgyNTkuMzg2ODUzOTcyNjU1NiwgNzAlLCA4MCUsIDAuMTcyMjM5NzQwNDA3OTA1NzcpIiBmaWx0ZXI9ImJsdXIoMzYuMTU3OTc2MzczMTc1NTNweCkiIG9wYWNpdHk9Ii4xNzIyIi8+CiA8ZWxsaXBzZSB0cmFuc2Zvcm09InJvdGF0ZSgtNy4yMDcgNjExLjQgMTQ2MCkiIGN4PSI2MTEuNCIgY3k9IjE0NjAiIHJ4PSIxMjYuOCIgcnk9IjYzLjM5IiBmaWxsPSJoc2xhKDE0MS44OTY0OTMxNjE5MDg1NSwgNzAlLCA4MCUsIDAuMzI1OTQ4NjAyMDkzMjcwMzcpIiBmaWx0ZXI9ImJsdXIoOS41NzE2Mjc4MjcyMDgxcHgpIiBvcGFjaXR5PSIuMzI1OSIvPgogPHJlY3QgdHJhbnNmb3JtPSJyb3RhdGUoLTM5Ljg2IDI3NjIgMTEyMykiIHg9IjI3MDciIHk9IjEwNjgiIHdpZHRoPSIxMTAuMiIgaGVpZ2h0PSIxMTAuMiIgcng9IjI3LjU1IiBmaWxsPSJoc2xhKDM1NC4xMjIzMzM2NjkxMDU2NywgNzAlLCA4MCUsIDAuMzA4OTk2Nzc1Njc0MzcyNTYpIiBmaWx0ZXI9ImJsdXIoMzUuNTkyMzU5MzQ4NTU0NzY2cHgpIiBvcGFjaXR5PSIuMzA5Ii8+CiA8cmVjdCB0cmFuc2Zvcm09InJvdGF0ZSgyMTUuMyAxMTA4IDE2Ni4xKSIgeD0iMTAzNyIgeT0iOTQuMzciIHdpZHRoPSIxNDMuNSIgaGVpZ2h0PSIxNDMuNSIgcng9IjM1Ljg2IiBmaWxsPSJoc2xhKDE5MC40NjU1ODA1ODAxNDA1NCwgNzAlLCA4MCUsIDAuMjgzNjc2ODU2MTMzOTIwMzUpIiBmaWx0ZXI9ImJsdXIoMjAuNjU4MzIyMTgwMTcxNjczcHgpIiBvcGFjaXR5PSIuMjgzNyIvPgogPGVsbGlwc2UgdHJhbnNmb3JtPSJyb3RhdGUoLTM2Ljg3IDExNi4zIDMyNC43KSIgY3g9IjExNi4zIiBjeT0iMzI0LjciIHJ4PSI5Ni4zNyIgcnk9IjQ4LjE4IiBmaWxsPSJoc2xhKDc3Ljc4NTM4MTQ5MTk0NTA2LCA3MCUsIDgwJSwgMC4yNDg2Nzc5MzI2Mzc3MzM3MikiIGZpbHRlcj0iYmx1cigyOS4zMTM0MzcyODY2Nzk1MzdweCkiIG9wYWNpdHk9Ii4yNDg3Ii8+CiA8ZWxsaXBzZSB0cmFuc2Zvcm09InJvdGF0ZSgxOTcuOCAxNjgyIDM1Ljk4KSIgY3g9IjE2ODIiIGN5PSIzNS45OCIgcng9IjM3LjY3IiByeT0iMTguODQiIGZpbGw9ImhzbGEoMzEwLjg0MjMzMjk5NjgzMjgsIDcwJSwgODAlLCAwLjEwMzI4NjU5MTUzMzEzMjU5KSIgZmlsdGVyPSJibHVyKDE5LjU5Njg3MzEyNjQ0MjAxNnB4KSIgb3BhY2l0eT0iLjEwMzMiLz4KIDxjaXJjbGUgdHJhbnNmb3JtPSJyb3RhdGUoMTIuMTkgOTQ3LjQgMTUzNSkiIGN4PSI5NDcuNCIgY3k9IjE1MzUiIHI9IjQyLjQxIiBmaWxsPSJoc2xhKDEwLjQxNDA4Njk4MjUxOTgyNywgNzAlLCA4MCUsIDAuMjQwMzkyNjM0MTg2NTg4MDQpIiBmaWx0ZXI9ImJsdXIoMi43MzEyOTExNzI1MTI1NzMzcHgpIiBvcGFjaXR5PSIuMjQwNCIvPgogPHRleHQgeD0iNTAlIiB5PSI1MCUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIGZpbGw9IiNmYWZhZmEiIGZpbHRlcj0idXJsKCNzaGFkb3cpIiBmb250LWZhbWlseT0iJ01hcGxlIE1vbm8gQ04nLCBtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMTI4IiBmb250LXdlaWdodD0iYm9sZCIgb3BhY2l0eT0iLjkiIHRleHQtYW5jaG9yPSJtaWRkbGUiPjx0c3BhbiB4PSI1MCUiIGR5PSIwIj5QYWdlT1M8L3RzcGFuPjwvdGV4dD4KPC9zdmc+Cg==");
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
      }
    </style>
    <style>
      /* 任务栏 */
      taskbar-container {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        height: var(--margin-padding); /* 底部触发区域高度 */
        z-index: 3100; /* 确保任务栏始终在最顶层 */
        pointer-events: auto;

        &:hover {
          height: var(--task-bar-height);
        }

        &:hover task-bar {
          bottom: var(--margin-padding);
          opacity: 1;
          pointer-events: auto;
        }
      }

      task-bar {
        position: absolute;
        background-color: var(--content-bg-color);
        border-radius: var(--border-radius);
        border: var(--border-thickness) solid var(--secondary-color);
        bottom: var(--margin-padding);
        height: var(--task-bar-height);
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        justify-content: space-between;
        align-items: center;
        width: 90%;
        max-width: 1024px;
        overflow: hidden;

        &.hide {
          bottom: calc(var(--task-bar-height) * -1);
          opacity: 0;
          pointer-events: none;
        }

        &:hover {
          box-shadow: var(--shadow);
          --secondary-color: var(--accent-color);
          --secondary-font-color: var(--accent-font-color);
        }

        & > *:first-child {
          border-left: none;
        }

        & > * {
          height: 100%;
          border-left: var(--border-thickness) solid var(--secondary-color);
          min-width: var(--task-bar-height);
          display: flex;

          & > * {
            padding: var(--margin-padding);
            height: 100%;
            min-width: var(--task-bar-height);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: calc(var(--border-radius) - var(--margin-padding));
            background-color: var(--content-bg-color);
          }
        }
      }

      window-buttons {
        flex: 1;

        & > * {
          border-top: var(--border-thickness) solid transparent;
          border-bottom: var(--border-thickness) solid transparent;

          & > * {
            pointer-events: none;
          }
        }

        & > *.focused {
          border-bottom: var(--border-thickness) solid var(--accent-color);
        }
      }

      bar-space > * {
        font-size: larger;
      }

      .app-launcher {
        background-image: var(--favicon);
      }

      .power {
        display: none;
      }
    </style>
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml;charset=utf-8;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMiIgaGVpZ2h0PSIzMiIgdmlld0JveD0iMCAwIDMyIDMyIj4KICA8IS0tIOWkluahhuefqeW9oiAtLT4KICA8cmVjdCB4PSIyIiB5PSIyIiB3aWR0aD0iMjgiIGhlaWdodD0iMjgiIHJ4PSIxMCIgcnk9IjEwIgogICAgZmlsbD0iIzQyNDI0MiIKICAgIHN0cm9rZT0iIzAwNjk1YyIKICAgIHN0cm9rZS13aWR0aD0iNCIvPgoKICA8IS0tIOW3puecvO+8muWwj+WchueCuSAtLT4KICA8Y2lyY2xlIGN4PSIxMiIgY3k9IjE0IiByPSIxLjUiIGZpbGw9IiNmNWY1ZjUiIC8+CgogIDwhLS0g5Y+z55y877ya5bCP5ZyG54K5IC0tPgogIDxjaXJjbGUgY3g9IjIwIiBjeT0iMTQiIHI9IjEuNSIgZmlsbD0iI2Y1ZjVmNSIgLz4KCiAgPCEtLSDpvLvlrZDvvJrnq5bnur8gLS0+CiAgPGxpbmUgeDE9IjE2IiB5MT0iMTYiIHgyPSIxNiIgeTI9IjE4IiBzdHJva2U9IiNmNWY1ZjUiIHN0cm9rZS13aWR0aD0iMS41IiAvPgoKICA8IS0tIOW+rueskeeahOWYtO+8muS4iuaJrOeahOW8p+e6vyAtLT4KICA8cGF0aCBkPSJNIDE0IDIwIFEgMTYgMjIgMTggMjAiIAogICAgICAgIGZpbGw9Im5vbmUiIAogICAgICAgIHN0cm9rZT0iI2Y1ZjVmNSIgCiAgICAgICAgc3Ryb2tlLXdpZHRoPSIxLjUiIAogICAgICAgIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgLz4KPC9zdmc+"
    />
  </head>
  <body>
    <bg></bg>
    <div id="windows-container"></div>
    <taskbar-container>
      <task-bar>
        <bar-space>
          <button class="app-launcher" title="应用程序启动器"></button>
          <button class="search" title="全局搜索"></button>
        </bar-space>
        <window-buttons></window-buttons>
        <status-space>
          <button class="power" title="电源状态"></button>
          <button class="date-time" title="日期时间">0/0/0 0:0</button>
        </status-space>
        <bar-space>
          <button class="exit" title="退出">󰍃</button>
        </bar-space>
      </task-bar>
    </taskbar-container>
    <script type="text/js-worker" id="processWorker">
      // 进程 Worker 脚本
      class WorkerProcess {
        constructor(id, parentId) {
          this.id = id;
          this.parentId = parentId;
          this.command = "";
          this.settings = {};
          this.active = false;
        }

        // 添加设置项
        addSetting(key, defaultValue) {
          this.settings[key] = defaultValue;
        }

        // 更新设置项
        updateSetting(key, value) {
          if (this.settings.hasOwnProperty(key)) {
            this.settings[key] = value;
          }
        }

        // 安全命令执行（白名单机制）
        safeExecute(commandName) {
          const commandMap = {
            log: (msg) => console.log(msg),
            calculate: (expr) => eval(expr), // 仅允许计算表达式
          };

          if (commandMap[commandName]) {
            return commandMap[commandName](...arguments);
          } else {
            console.error(`未知命令: ${commandName}`);
          }
        }

        // 发送消息到主线程
        sendMessage(targetId, messageType, data) {
          self.postMessage({
            type: "process-message",
            from: this.id,
            targetId,
            messageType,
            data,
          });
        }

        // 处理主线程消息
        handleMessage(event) {
          const { type, data } = event.data;
          if (type === "execute") {
            const [cmd, ...args] = data.command.split(" ");
            return this.safeExecute(cmd, ...args);
          } else if (type === "update-setting") {
            this.updateSetting(data.key, data.value);
          } else if (type === "message") {
            // 处理其他进程消息
            console.log(`进程 ${this.id} 收到消息:`, data);
          }
        }
      }

      // Worker 入口
      self.addEventListener("message", (event) => {
        if (event.data.type === "init") {
          const { id, parentId } = event.data;
          const process = new WorkerProcess(id, parentId);

          // 处理后续消息
          self.addEventListener("message", (e) => {
            process.handleMessage(e);
          });

          self.postMessage({ type: "ready", id });
        }
      });
    </script>
    <script>
      (function () {
        // 统一焦点管理器（合并输入管理和焦点管理）
        class FocusManager {
          constructor() {
            // 原FocusManager属性
            this.focusedWindowId = null;
            this.focusedElement = null;

            // 原InputManager属性
            this.windowStack = []; // 窗口堆叠顺序（最近使用在前）
            this.captureInputProcess = null; // 捕获输入的进程ID
          }

          // 任务栏窗口按钮样式更新
          updateWindowButtons(windowId) {
            const winBtns = document.querySelectorAll(
              "task-bar window-buttons button"
            );
            winBtns.forEach((winBtn) => {
              winBtn.classList.toggle(
                "focused",
                winBtn.dataset.windowId === windowId
              );
            });
          }

          // 设置焦点窗口
          focusWindow(windowId) {
            if (this.focusedWindowId === windowId) return;

            // 移除旧窗口的焦点
            if (this.focusedWindowId) {
              const prevWindow = wManager.windows.get(this.focusedWindowId);
              if (prevWindow) prevWindow.blur();
            }

            // 更新窗口堆叠顺序（原 InputManager 逻辑）
            this.windowStack = this.windowStack.filter((id) => id !== windowId);
            this.windowStack.unshift(windowId);

            // 设置新焦点窗口
            this.focusedWindowId = windowId;
            this.releaseInput(); // 窗口聚焦时释放输入捕获

            const window = wManager.windows.get(windowId);
            if (window) {
              window.focus();
              this.updateWindowButtons(windowId);
            }
          }

          // 设置捕获输入的进程（原 InputManager 方法）
          captureInput(processId) {
            this.captureInputProcess = processId;
          }

          // 释放输入捕获（原 InputManager 方法）
          releaseInput() {
            this.captureInputProcess = null;
          }

          // 移除已关闭窗口的状态（合并原 InputManager 和 FocusManager 逻辑）
          removeWindow(windowId) {
            // 原 InputManager 窗口移除逻辑
            this.windowStack = this.windowStack.filter((id) => id !== windowId);
            if (this.focusedWindowId === windowId) {
              this.focusedWindowId = null;
              if (this.windowStack.length > 0) {
                this.focusWindow(this.windowStack[0]);
              }
            }

            // 原 FocusManager 窗口移除逻辑
            if (this.focusedWindowId === windowId) {
              this.focusedWindowId = null;
            }
            if (
              this.focusedElement &&
              this.focusedElement.closest(`[data-window-id="${windowId}"]`)
            ) {
              this.focusedElement = null;
            }
          }

          // 切换到下一个窗口 (Alt+Tab)（原 InputManager 方法）
          nextWindow() {
            if (this.windowStack.length < 2) return;

            // 将当前窗口移到末尾
            const current = this.windowStack.shift();
            this.windowStack.push(current);

            // 聚焦新窗口
            this.focusedWindowId = this.windowStack[0];
            return this.focusedWindowId;
          }

          // 设置焦点元素（原 FocusManager 方法）
          focusElement(element, windowId) {
            if (this.focusedElement) {
              this.focusedElement.blur();
            }

            this.focusedElement = element;
            this.focusWindow(windowId);
            element.focus();
          }

          // 清除焦点（原 FocusManager 方法）
          clearFocus() {
            // 清除当前焦点元素
            if (this.focusedElement) {
              this.focusedElement.blur();
              this.focusedElement = null;
            }

            // 清除当前焦点窗口的样式
            if (this.focusedWindowId) {
              const prevWindow = wManager.windows.get(this.focusedWindowId);
              if (prevWindow) prevWindow.blur();
              this.focusedWindowId = null;
            }

            this.updateWindowButtons(this.focusedWindowId);
          }
        }

        // 层级管理器
        class LayerManager {
          static LAYERS = {
            BACKGROUND: { zIndex: 100, maxWindows: 10 }, // 背景层
            WINDOW: { zIndex: 1000, maxWindows: 100 }, // 窗口层
            TOP: { zIndex: 3000, maxWindows: 10 }, // 顶层（弹窗、菜单等）
          };

          constructor() {
            this.windowLayers = new Map(); // windowId -> layerType
            this.layerStacks = {
              BACKGROUND: [],
              WINDOW: [],
              TOP: [],
            };
          }

          // 添加窗口到指定层
          addToLayer(windowId, layerType = "WINDOW") {
            if (!LayerManager.LAYERS[layerType]) {
              console.error(`无效的层级类型: ${layerType}`);
              return;
            }

            // 从原有层移除
            this.removeWindow(windowId);

            // 添加到新层
            this.windowLayers.set(windowId, layerType);
            this.layerStacks[layerType].push(windowId);

            // 确保不超过最大窗口数
            const maxWindows = LayerManager.LAYERS[layerType].maxWindows;
            if (this.layerStacks[layerType].length > maxWindows) {
              const removedId = this.layerStacks[layerType].shift();
              this.windowLayers.delete(removedId);
            }

            // 层级变更时更新所有窗口
            this.updateAllWindows();
          }

          // 获取窗口所在层
          getWindowLayer(windowId) {
            return this.windowLayers.get(windowId) || "WINDOW";
          }

          // 提升窗口到层内最前
          bringToFront(windowId) {
            const layerType = this.getWindowLayer(windowId);
            const stack = this.layerStacks[layerType];

            // 从原位置移除
            const index = stack.indexOf(windowId);
            if (index > -1) {
              stack.splice(index, 1);
            }

            // 添加到栈顶
            stack.push(windowId);

            // 层级变更时更新所有窗口
            this.updateAllWindows();
          }

          // 移除窗口
          removeWindow(windowId) {
            const layerType = this.getWindowLayer(windowId);
            if (layerType) {
              const stack = this.layerStacks[layerType];
              const index = stack.indexOf(windowId);
              if (index > -1) {
                stack.splice(index, 1);
              }
            }
            this.windowLayers.delete(windowId);

            // 层级变更时更新所有窗口
            this.updateAllWindows();
          }

          // 遍历更新所有窗口层级（新增方法）
          updateAllWindows() {
            // 遍历所有层
            for (const [layerType, stack] of Object.entries(this.layerStacks)) {
              const baseZIndex = LayerManager.LAYERS[layerType].zIndex;

              // 遍历层内所有窗口
              stack.forEach((windowId, index) => {
                const window = wManager.windows.get(windowId);
                if (window) {
                  // 计算z-index: 基础值 + 在层内的位置
                  window.element.style.zIndex = baseZIndex + index;
                }
              });
            }
          }
        }

        // 全局焦点管理器实例
        const fManager = new FocusManager();

        // 窗口管理类
        class WindowManager {
          constructor() {
            this.windows = new Map();
            this.layerManager = new LayerManager();
            this.windowIdCounter = 0;
            this.windowsContainer =
              document.getElementById("windows-container");
            // 全屏窗口计数
            this.fullscreenCount = 0;
            this.taskBar = document.querySelector("task-bar");
          }

          // 创建新窗口
          createWindow(processId, config = {}) {
            const windowId = `window-${this.windowIdCounter++}`; // 使用递增ID
            const win = new PageWin(windowId, processId, config);
            this.windows.set(windowId, win);
            this.windowsContainer.appendChild(win.element);

            // 如果窗口初始为全屏，则增加计数
            if (config.fullscreen) {
              this.updateFullscreenCount(1);
            }

            // 任务栏窗口按钮
            const taskbar = document.querySelector("task-bar window-buttons");
            const windowBtn = document.createElement("button");
            windowBtn.innerHTML = win.config.icon
              ? win.config.icon
              : win.config.title[0];
            windowBtn.title = win.config.title;
            windowBtn.dataset.windowId = windowId;
            windowBtn.addEventListener("click", () => {
              fManager.focusWindow(windowId);
              this.focusWindow(windowId);
            });

            // 设置右键菜单选项
            const menuOptions = [
              { label: "移动窗口", action: "move" },
              { label: "最小化", action: "minimize" },
              { label: "最大化", action: "maximize" },
              { label: "关闭", action: "close" },
            ];
            windowBtn.dataset.menuOptions = JSON.stringify(menuOptions);
            taskbar.appendChild(windowBtn);

            return windowId;
          }

          // TODO: 是否删除：聚焦窗口
          focusWindow(windowId) {
            const win = this.windows.get(windowId);
            if (win) {
              // 使用层级管理器设置z-index
              const zIndex = this.layerManager.bringToFront(windowId);
              win.element.style.zIndex = zIndex;
              win.focus(); // 通知窗口获得焦点
            }
          }

          // 关闭窗口的统一入口
          closeWindow(windowId) {
            const win = this.windows.get(windowId);
            if (win) {
              // 如果窗口是全屏状态，则减少计数
              if (win.config.fullscreen) {
                this.updateFullscreenCount(-1);
              }
              win.cleanup();
              this.windows.delete(windowId);
              win.element.remove();

              // 删除任务栏窗口按钮
              const taskbar = document.querySelector("task-bar window-buttons");
              taskbar.querySelector(`[data-window-id="${windowId}"]`).remove();

              // 更新焦点管理器和层级管理器
              fManager.removeWindow(windowId);
              this.layerManager.removeWindow(windowId);
            }
          }

          moveWindow(windowId) {
            const win = this.windows.get(windowId);
            if (win) {
              // 激活窗口
              this.focusWindow(windowId);
              fManager.focusWindow(windowId);

              win.element.classList.add("dragging");
              win.isDragging = true;
            }
          }

          minimizeWindow(windowId) {
            const win = this.windows.get(windowId);
            if (win) {
              win.toggleMinimize();
            }
          }

          maximizeWindow(windowId) {
            const win = this.windows.get(windowId);
            if (win) {
              win.toggleMaximize();
            }
          }

          // 通过进程 ID 获取窗口
          getWindowsByProcess(processId) {
            return Array.from(this.windows.values()).filter(
              (w) => w.processId === processId
            );
          }

          // 更新全屏窗口计数
          updateFullscreenCount(change) {
            this.fullscreenCount += change;
            if (this.fullscreenCount < 0) {
              this.fullscreenCount = 0;
            }
            if (this.fullscreenCount > 0) {
              this.taskBar.classList.add("hide");
            } else {
              this.taskBar.classList.remove("hide");
            }
          }
        }

        // 窗口类
        class PageWin {
          constructor(id, processId, config) {
            var i = document.createElement("i");
            i.textContent = "空内容";
            this.id = id;
            this.processId = processId;
            this.config = {
              css: {},
              borderless: false,
              fullscreen: false,
              minimized: false,
              icon: "",
              title: "窗口",
              width: 400,
              height: 300,
              x: 50,
              y: 50,
              tabs: [
                {
                  title: "标签页",
                  css: {},
                  content: i,
                },
              ], // { title: string, css: string }[]
              ...config,
            };
            this.activeTabIndex = 0;
            this.isDragging = false;
            this.dragOffset = { x: 0, y: 0 };
            this.isResizing = false;
            this.resizeDirection = null;
            this.originalSize = null;
            this.originalPosition = null;
            this.preMaximizeState = null;

            this.createDOM();
            this.setupEventListeners();
          }

          // 创建窗口DOM结构
          createDOM() {
            this.element = document.createElement("div");
            this.element.dataset.windowId = this.id;
            for (var property in this.config.css) {
              this.element.style[property] = this.config.css[property];
            }
            this.element.style.width = `${this.config.width}px`;
            this.element.style.height = `${this.config.height}px`;
            this.element.style.left = `${this.config.x}px`;
            this.element.style.top = `${this.config.y}px`;
            this.element.tabIndex = -1; // 使窗口可聚焦

            this.element.classList.add("window");
            if (this.config.borderless) {
              this.element.classList.add("borderless");
            }
            if (this.config.fullscreen) {
              this.element.classList.add("fullscreen");
            }
            if (this.config.minimized) {
              this.element.classList.add("minimized");
            }

            // 标题栏
            const titleBar = document.createElement("div");
            titleBar.className = "window-title-bar";
            titleBar.innerHTML = `<div class="window-icon">${
              this.config.icon ? this.config.icon : this.config.title[0]
            }</div>
<div class="window-title">${this.config.title}</div>
<div class="window-controls">
  <button class="minimize"></button>
  <button class="maximize"></button>
  <button class="close"></button>
</div>`;

            // 标签页栏
            const tabBar = document.createElement("div");
            tabBar.className = "window-tab-bar";
            this.config.tabs.forEach((tab, index) => {
              const tabEl = document.createElement("div");
              tabEl.className = `tab ${
                index === this.activeTabIndex ? "active" : ""
              }`;
              tabEl.textContent = tab.title;
              tabEl.dataset.tabIndex = index;
              tabBar.appendChild(tabEl);
            });

            // 内容区
            const content = document.createElement("div");
            content.className = "window-content";
            this.config.tabs.forEach((tab, index) => {
              const tabConEl = document.createElement("div");
              tabConEl.className = `tab-content ${
                index === this.activeTabIndex ? "active" : ""
              }`;
              if (tab.content) {
                try {
                  tabConEl.appendChild(tab.content);
                } catch (e) {
                  var p = document.createElement("p");
                  p.style.color = "var(--danger-color)";
                  p.textContent = e;
                  tabConEl.appendChild(p);
                }
              } else {
                var i = document.createElement("i");
                i.textContent = "空内容";
                tabConEl.appendChild(i);
              }
              tabConEl.dataset.tabContentIndex = index;
              for (var property in tab.css) {
                tabConEl.style[property] = tab.css[property];
              }
              content.appendChild(tabConEl);
            });

            this.element.appendChild(titleBar);
            if (this.config.tabs.length > 1) {
              this.element.appendChild(tabBar);
            }
            this.element.appendChild(content);

            // 调整大小手柄
            const resizeHandle = document.createElement("div");
            resizeHandle.className = "resize-handle";
            this.element.appendChild(resizeHandle);
            this.switchTab(0);
          }

          // 设置事件监听
          setupEventListeners() {
            const titleBar = this.element.querySelector(".window-title-bar");
            const minimizeBtn = this.element.querySelector(".minimize");
            const maximizeBtn = this.element.querySelector(".maximize");
            const closeBtn = this.element.querySelector(".close");
            const tabs = this.element.querySelectorAll(".tab");
            const resizeHandle = this.element.querySelector(".resize-handle");

            this.element.addEventListener("mousedown", (e) => {
              wManager.focusWindow(this.id);
              fManager.focusWindow(this.id);
            });

            // 拖动窗口
            titleBar.addEventListener("mousedown", (e) => {
              if (
                e.target === minimizeBtn ||
                e.target === maximizeBtn ||
                e.target === closeBtn
              ) {
                return;
              }
              this.isDragging = true;
              this.element.classList.add("dragging");
              if (this.config.fullscreen) {
                this.dragOffset = {
                  x: (this.config.width / window.innerWidth) * e.clientX,
                  y: e.clientY,
                };
                this.element.style.left = `${e.clientX - this.dragOffset.x}px`;
                this.element.style.top = `${e.clientY - this.dragOffset.y}px`;
                this.toggleMaximize();
              } else {
                this.dragOffset = {
                  x: e.clientX - this.element.offsetLeft,
                  y: e.clientY - this.element.offsetTop,
                };
              }
            });

            this.handleDocumentMouseMove = (e) => {
              if (this.isDragging) {
                this.element.style.left = `${e.clientX - this.dragOffset.x}px`;
                this.element.style.top = `${e.clientY - this.dragOffset.y}px`;
              }
            };

            this.handleDocumentMouseUp = () => {
              this.isDragging = false;
              this.element.classList.remove("dragging");
            };

            document.addEventListener(
              "mousemove",
              this.handleDocumentMouseMove
            );
            document.addEventListener("mouseup", this.handleDocumentMouseUp);

            // 窗口控制按钮
            minimizeBtn.addEventListener("click", () => this.toggleMinimize());
            maximizeBtn.addEventListener("click", () => this.toggleMaximize());
            closeBtn.addEventListener("click", () =>
              wManager.closeWindow(this.id)
            );

            // 标签页切换
            tabs.forEach((tab) => {
              tab.addEventListener("click", (e) => {
                const tabIndex = parseInt(e.target.dataset.tabIndex);
                this.switchTab(tabIndex);
                fManager.focusWindow(this.id);
              });
            });

            // 调整大小事件
            resizeHandle.addEventListener("mousedown", this.handleResizeStart);
          }

          // 窗口获得焦点
          focus() {
            if (this.config.minimized) {
              this.config.minimized = !this.config.minimized;
              this.element.classList.remove("minimized");
            }
            this.element.classList.add("focused");
          }

          // 窗口失去焦点
          blur() {
            this.element.classList.remove("focused");
          }

          // 切换标签页
          switchTab(index) {
            this.activeTabIndex = index;
            const tabs = this.element.querySelectorAll(".tab");
            const contents = this.element.querySelectorAll(".tab-content");

            tabs.forEach((tab, i) => {
              tab.classList.toggle("active", i === index);
            });
            contents.forEach((content, i) => {
              content.classList.toggle("active", i === index);
            });
          }

          // 最小化/恢复窗口
          toggleMinimize() {
            if (this.config.fullscreen) {
              this.config.fullscreen = !this.config.fullscreen;
              this.element.classList.remove("fullscreen");
              wManager.updateFullscreenCount(-1);
            }
            fManager.clearFocus();
            this.config.minimized = !this.config.minimized;
            this.element.classList.toggle("minimized", this.config.minimized);
          }

          // 最大化/恢复窗口
          toggleMaximize() {
            if (this.config.minimized) {
              this.config.minimized = !this.config.minimized;
              this.element.classList.remove("minimized");
            }
            const wasFullscreen = this.config.fullscreen;
            this.config.fullscreen = !this.config.fullscreen;
            const isNowFullscreen = this.config.fullscreen;
            this.element.classList.toggle("fullscreen", this.config.fullscreen);

            // 更新全屏计数
            if (wasFullscreen && !isNowFullscreen) {
              wManager.updateFullscreenCount(-1);
            } else if (!wasFullscreen && isNowFullscreen) {
              wManager.updateFullscreenCount(1);
            }
          }

          // 关闭窗口
          cleanup() {
            // 移除所有事件监听器
            document.removeEventListener(
              "mousemove",
              this.handleDocumentMouseMove
            );
            document.removeEventListener("mouseup", this.handleDocumentMouseUp);
            document.removeEventListener("mousemove", this.handleResize);
            document.removeEventListener("mouseup", this.handleResizeEnd);

            // 从窗口元素移除 win-close 监听器
            if (this.closeHandler) {
              this.element.removeEventListener("win-close", this.closeHandler);
            }

            // 通知管理器移除窗口状态（统一管理）
            fManager.removeWindow(this.id);
          }

          // 设置关闭处理器
          setCloseHandler(handler) {
            this.closeHandler = handler;
            this.element.addEventListener("win-close", handler);
          }

          close() {
            // 触发关闭事件
            this.element.dispatchEvent(
              new CustomEvent("win-close", { bubbles: true })
            );
            // 清理窗口
            this.cleanup();
            // 从DOM和管理器中移除
            this.element.remove();
            wManager.windows.delete(this.id);
          }

          // 调整大小功能
          handleResizeStart = (e) => {
            e.stopPropagation();
            this.isResizing = true;
            this.element.classList.add("resizing");
            this.resizeStartX = e.clientX;
            this.resizeStartY = e.clientY;
            this.originalWidth = this.element.offsetWidth;
            this.originalHeight = this.element.offsetHeight;
            document.addEventListener("mousemove", this.handleResize);
            document.addEventListener("mouseup", this.handleResizeEnd);
            wManager.focusWindow(this.id);
            fManager.focusWindow(this.id);
          };

          handleResize = (e) => {
            if (!this.isResizing) return;

            const dx = e.clientX - this.resizeStartX;
            const dy = e.clientY - this.resizeStartY;

            const minWidth = 200;
            const minHeight = 150;

            const newWidth = Math.max(minWidth, this.originalWidth + dx);
            const newHeight = Math.max(minHeight, this.originalHeight + dy);

            this.element.style.width = `${newWidth}px`;
            this.element.style.height = `${newHeight}px`;
          };

          handleResizeEnd = () => {
            this.isResizing = false;
            this.element.classList.remove("resizing");
            document.removeEventListener("mousemove", this.handleResize);
            document.removeEventListener("mouseup", this.handleResizeEnd);
          };
        }

        // 全局窗口管理器实例
        const wManager = new WindowManager();

        // 拦截全局输入事件
        document.addEventListener("keydown", (e) => {
          // 只有焦点窗口能接收键盘事件
          if (!fManager.focusedWindowId) return;

          // 阻止事件冒泡到非焦点窗口
          const targetWindow = e.target.closest(".window");
          if (
            !targetWindow ||
            targetWindow.dataset.windowId !== fManager.focusedWindowId
          ) {
            e.stopPropagation();
          }
        });

        document.addEventListener("mousedown", (e) => {
          const windowElement = e.target.closest(".window");
          if (windowElement) {
            // 点击窗口时设置焦点
            fManager.focusWindow(windowElement.dataset.windowId);
          } else {
            // 点击窗口外区域清除焦点
            fManager.clearFocus();
          }
        });

        class ProcessManager {
          constructor() {
            this.workers = new Map();
            this.registry = new Map(); // 权限注册表 {进程 ID: 允许通信的目标 ID 集合}
          }

          // 创建新进程
          async createProcess(id, parentId = null) {
            const workerScript =
              document.querySelector("#processWorker").textContent;
            const blob = new Blob([workerScript], {
              type: "application/javascript",
            });
            const worker = new Worker(URL.createObjectURL(blob));
            this.workers.set(id, worker);

            // 初始化权限
            this.registry.set(id, new Set());
            if (parentId) {
              this.allowCommunication(parentId, id);
            }

            // 处理 Worker 消息
            worker.onmessage = (event) => {
              if (event.data.type === "process-message") {
                const { targetId, messageType, data, from } = event.data;
                this.sendMessage(from, targetId, messageType, data);
              }
            };

            // 初始化 Worker
            worker.postMessage({
              type: "init",
              id,
              parentId,
            });

            return new Promise((resolve) => {
              worker.addEventListener(
                "message",
                function ready(e) {
                  if (e.data.type === "ready") {
                    resolve();
                  }
                },
                { once: true }
              );
            });
          }

          // 允许进程通信
          allowCommunication(sourceId, targetId) {
            if (this.registry.has(sourceId)) {
              this.registry.get(sourceId).add(targetId);
            }
          }

          // 发送进程消息
          sendMessage(sourceId, targetId, messageType, data) {
            if (!this.registry.get(sourceId)?.has(targetId)) {
              console.error(`进程 ${sourceId} 无权向 ${targetId} 发送消息`);
              return;
            }

            const worker = this.workers.get(targetId);
            if (worker) {
              worker.postMessage({
                type: "message",
                data: {
                  type: messageType,
                  data,
                  from: sourceId,
                },
              });
            }
          }

          // 执行进程命令
          executeCommand(processId, command) {
            const worker = this.workers.get(processId);
            if (worker) {
              worker.postMessage({
                type: "execute",
                data: { command },
              });
            }
          }

          // 更新进程设置
          updateSetting(processId, key, value) {
            const worker = this.workers.get(processId);
            if (worker) {
              worker.postMessage({
                type: "update-setting",
                data: { key, value },
              });
            }
          }

          // 终止进程
          terminateProcess(processId) {
            const worker = this.workers.get(processId);
            if (worker) {
              worker.terminate();
              this.workers.delete(processId);
              this.registry.delete(processId);
            }
          }
        }

        // 初始化进程管理器
        const pManager = new ProcessManager();

        // 自定义右键菜单功能
        function initOptionMenu(doc) {
          // 初始化样式
          var style = doc.createElement("style");
          style.type = "text/css";
          style.innerHTML = `
            #custom-context-menu {
              --accent-color: #64ffda; /* 强调色：边框 */
              --secondary-color: #00695c; /* 次要色：未激活边框 */
              --danger-color: #ff6d00; /* 着重色：边框 */
              --accent-bg-color: #009688;
              --secondary-bg-color: #616161;
              --content-bg-color: #424242;
              --accent-font-color: #f5f5f5;
              --secondary-font-color: #eeeeee;

              --margin-padding: 0.5rem;
              --border-thickness: 0.2rem;
              --border-radius: 0.5rem;
              --title-bar-height: 2rem;
              --title-bar-justify-content: left;
              --task-bar-height: 3rem;

              --shadow: 0.6rem 0.6rem 0.1rem 0.1rem rgba(0, 0, 0, 0.2);
              --focused-bg-color: rgba(255, 255, 255, 0.1);

              font-size: small;
              user-select: none;
              position: absolute;
              background-color: var(--content-bg-color);
              border: var(--border-thickness) solid var(--secondary-color);
              border-radius: var(--border-radius);
              padding: 0;
              opacity: 0;
              transform: scale(0.8);
              pointer-events: none;
              z-index: 4000; /* 确保在顶层 */
              min-width: 150px;

              &.show {
                display: block;
                opacity: 1;
                transform: scale(1);
                pointer-events: auto;
              }

              &:hover {
                box-shadow: var(--shadow);
                --secondary-color: var(--accent-color);
              }
            }

            #custom-context-menu ul {
              list-style: none;
              margin: 0;
              padding: 0;
            }

            #custom-context-menu li {
              padding: var(--margin-padding);
              cursor: pointer;
              list-style-type: none; /* 去除列表项标记 */
            }

            #custom-context-menu li:hover {
              background-color: var(--focused-bg-color);
            }`;
          style.id = "addStyle";
          doc.getElementsByTagName("HEAD").item(0).appendChild(style);

          // 初始化元素
          const contextMenu = doc.createElement("ul");
          contextMenu.id = "custom-context-menu";
          doc.body.appendChild(contextMenu);

          // 监听全局右键点击事件
          doc.addEventListener("contextmenu", function (e) {
            // 阻止默认右键菜单
            e.preventDefault();

            // 获取被点击的元素
            const target = e.target;
            const selection = window.getSelection();
            const hasSelection =
              selection && selection.toString().trim().length > 0;

            // 检查事件目标是否在选区内
            let inSelection = false;
            if (hasSelection && selection.rangeCount > 0) {
              const range = selection.getRangeAt(0);
              inSelection = range.intersectsNode(e.target);
            }

            // 如果有文本被选中且右键点击在选区内，显示默认文本操作菜单
            if (hasSelection && inSelection) {
              const defaultTextOptions = [
                { label: "复制", action: "copy" },
                { label: "剪切", action: "cut" },
                { label: "粘贴", action: "paste" },
                { label: "全选", action: "selectAll" },
              ];

              // 清空菜单
              contextMenu.innerHTML = "";
              // 生成菜单项
              defaultTextOptions.forEach((option) => {
                const li = doc.createElement("li");
                li.textContent = option.label;
                li.onclick = function () {
                  if (option.action === "copy") {
                    doc.execCommand("copy");
                  } else if (option.action === "cut") {
                    doc.execCommand("cut");
                  } else if (option.action === "paste") {
                    doc.execCommand("paste");
                  } else if (option.action === "selectAll") {
                    doc.execCommand("selectAll");
                  }
                  contextMenu.classList.remove("show");
                };
                contextMenu.appendChild(li);
              });

              // 显示菜单（确保在屏幕内）
              contextMenu.classList.add("show");

              // 获取菜单尺寸
              const menuWidth = contextMenu.offsetWidth;
              const menuHeight = contextMenu.offsetHeight;

              // 计算调整后的位置
              let adjustedLeft = e.pageX;
              let adjustedTop = e.pageY;

              // 如果靠近右边缘，向左偏移
              if (window.innerWidth - e.pageX < menuWidth) {
                adjustedLeft = e.pageX - menuWidth;
              }

              // 如果靠近下边缘，向上偏移
              if (window.innerHeight - e.pageY < menuHeight) {
                adjustedTop = e.pageY - menuHeight;
              }

              contextMenu.style.left = adjustedLeft + "px";
              contextMenu.style.top = adjustedTop + "px";
            }
            // 否则检查元素的data-menu-options属性
            else if (target.dataset.menuOptions) {
              try {
                // 解析JSON字符串
                const menuOptions = JSON.parse(target.dataset.menuOptions);
                // 清空菜单
                contextMenu.innerHTML = "";
                // 动态生成菜单项
                menuOptions.forEach((option) => {
                  const li = doc.createElement("li");
                  li.textContent = option.label;
                  li.onclick = function () {
                    // 执行action
                    if (option.action) {
                      // 触发自定义事件
                      const event = new CustomEvent(
                        "custom-contextmenu-action",
                        {
                          detail: {
                            action: option.action,
                            target: target,
                          },
                        }
                      );
                      doc.dispatchEvent(event);
                    }
                    // 隐藏菜单
                    contextMenu.classList.remove("show");
                  };
                  contextMenu.appendChild(li);
                });

                // 显示菜单（确保在屏幕内）
                contextMenu.classList.add("show");

                // 获取菜单尺寸
                const menuWidth = contextMenu.offsetWidth;
                const menuHeight = contextMenu.offsetHeight;

                // 计算调整后的位置
                let adjustedLeft = e.pageX;
                let adjustedTop = e.pageY;

                // 如果靠近右边缘，向左偏移
                if (window.innerWidth - e.pageX < menuWidth) {
                  adjustedLeft = e.pageX - menuWidth;
                }

                // 如果靠近下边缘，向上偏移
                if (window.innerHeight - e.pageY < menuHeight) {
                  adjustedTop = e.pageY - menuHeight;
                }

                contextMenu.style.left = adjustedLeft + "px";
                contextMenu.style.top = adjustedTop + "px";
              } catch (error) {
                console.error("解析菜单选项失败", error);
              }
            } else {
              // 如果没有定义菜单选项，则隐藏菜单
              contextMenu.classList.remove("show");
            }
          });

          // 点击其他地方隐藏菜单
          doc.addEventListener("click", function () {
            contextMenu.classList.remove("show");
          });

          // 阻止菜单内部的点击事件冒泡
          contextMenu.addEventListener("click", function (e) {
            e.stopPropagation();
          });

          // 处理任务栏窗口按钮的右键菜单动作
          doc.addEventListener("custom-contextmenu-action", function (e) {
            const { action, target } = e.detail;
            const windowId = target.dataset.windowId;
            if (!windowId) return;

            if (action === "move") {
              wManager.moveWindow(windowId);
            } else if (action === "minimize") {
              wManager.minimizeWindow(windowId);
            } else if (action === "maximize") {
              wManager.maximizeWindow(windowId);
            } else if (action === "close") {
              wManager.closeWindow(windowId);
            }
          });
        }

        initOptionMenu(document);

        (async function init() {
          // (async function desktop() {
          //   // 为桌面进程创建全屏无边框窗口（桌面背景）
          //   const desktopWin = wManager.createWindow("desktop", {
          //     css: {
          //       "z-index": "-1",
          //       "pointer-events": "none",
          //     },
          //     borderless: true,
          //     fullscreen: true,
          //     title: "桌面背景",
          //     tabs: [
          //       {
          //         title: "桌面",
          //         css: {
          //           position: "absolute",
          //           top: "0",
          //           left: "0",
          //           width: "100%",
          //           height: "100%",
          //           background: "linear-gradient(#EEE, #666)",
          //           "z-index": "-1",
          //           overflow: "hidden",
          //         },
          //         content: " ",
          //       },
          //     ],
          //   });
          // })();

          (async function taskBar() {
            const taskBarProcess = await pManager.createProcess("taskBar");
            const taskbarContainer =
              document.querySelector("taskbar-container");
            const taskBar = taskbarContainer.querySelector("task-bar");

            (async function time() {
              // 日期时间显示功能
              const updateDateTime = () => {
                const now = new Date();
                const dateStr = now.toLocaleDateString("zh-CN", {
                  year: "numeric",
                  month: "2-digit",
                  day: "2-digit",
                });
                const timeStr = now.toLocaleTimeString("zh-CN", {
                  hour: "2-digit",
                  minute: "2-digit",
                });
                taskBar.querySelector(
                  ".date-time"
                ).textContent = `${dateStr} ${timeStr}`;
              };

              // 初始更新并设置定时器
              updateDateTime();
              setInterval(updateDateTime, 1000);
            })();

            (async function power() {
              // 电池状态功能（https://developer.mozilla.org/zh-CN/docs/Web/API/Battery_Status_API）
              const powerButton = taskBar.querySelector(".power");

              async function updateBatteryStatus() {
                try {
                  if (!navigator.getBattery) {
                    powerButton.title = "电池状态不可用";
                    powerButton.textContent = "󰂃"; // 感叹号图标
                    console.warn("浏览器不支持电池状态 API");
                    return;
                  }

                  const battery = await navigator.getBattery();
                  const level = Math.floor(battery.level * 100);
                  let statusText = `电量: ${level}%`;
                  let batteryIcon = "󰂃"; // 默认感叹号图标

                  // 充电状态使用充电图标
                  if (battery.charging) {
                    batteryIcon = "󰂄";
                    statusText += " (充电中)";
                    if (battery.chargingTime < Infinity) {
                      statusText += ` | 充满时间: ${Math.floor(
                        battery.chargingTime / 60
                      )}分钟`;
                    }
                  }
                  // 非充电状态根据电量选择图标
                  else {
                    const icons = [
                      "󰁺", // 10%
                      "󰁻", // 20%
                      "󰁼", // 30%
                      "󰁽", // 40%
                      "󰁾", // 50%
                      "󰁿", // 60%
                      "󰂀", // 70%
                      "󰂁", // 80%
                      "󰂂", // 90%
                      "󰁹", // 100%
                    ];
                    const index = Math.min(Math.floor(level / 10), 9);
                    batteryIcon = level <= 10 ? "󰂃" : icons[index];

                    if (battery.dischargingTime < Infinity) {
                      statusText += ` | 剩余时间: ${Math.floor(
                        battery.dischargingTime / 60
                      )}分钟`;
                    }
                  }

                  powerButton.textContent = batteryIcon;
                  powerButton.title = statusText;
                  powerButton.style.display = "block";

                  // 添加事件监听器
                  battery.addEventListener(
                    "chargingchange",
                    updateBatteryStatus
                  );
                  battery.addEventListener("levelchange", updateBatteryStatus);
                  battery.addEventListener(
                    "chargingtimechange",
                    updateBatteryStatus
                  );
                  battery.addEventListener(
                    "dischargingtimechange",
                    updateBatteryStatus
                  );
                } catch (error) {
                  powerButton.textContent = "󰂃";
                  powerButton.title = "电池状态检测失败";
                  console.warn("获取电池状态失败:", error);
                }
              }

              // 点击显示详细状态
              powerButton.addEventListener("click", async () => {
                try {
                  if (navigator.getBattery) {
                    const battery = await navigator.getBattery();
                    const statusDetails = [
                      `电量: ${Math.floor(battery.level * 100)}%`,
                      `充电状态: ${battery.charging ? "充电中" : "未充电"}`,
                      `充电时间: ${
                        battery.chargingTime === Infinity
                          ? "未知"
                          : Math.floor(battery.chargingTime / 60) + "分钟"
                      }`,
                      `放电时间: ${
                        battery.dischargingTime === Infinity
                          ? "未知"
                          : Math.floor(battery.dischargingTime / 60) + "分钟"
                      }`,
                    ].join("\n");

                    var e = document.createElement("pre");
                    e.textContent = statusDetails;

                    // 创建电池状态窗口
                    const batteryWinId = wManager.createWindow("taskBar", {
                      title: "电池状态",
                      width: 300,
                      height: 200,
                      x: window.screen.width / 2 - 150,
                      y: window.screen.height / 2 - 100,
                      tabs: [
                        {
                          title: "详细信息",
                          content: e,
                        },
                      ],
                    });
                  }
                } catch (error) {
                  var e = document.createElement("p");
                  e.style.color = "var(--danger-color)";
                  e.textContent = "无法获取电池详细信息" + error;
                  // 创建错误提示窗口
                  const errorWinId = wManager.createWindow("taskBar", {
                    title: "错误",
                    width: 250,
                    height: 100,
                    x: window.screen.width / 2 - 125,
                    y: window.screen.height / 2 - 50,
                    tabs: [
                      {
                        title: "提示",
                        content: e,
                      },
                    ],
                  });
                }
              });

              // 初始化电池状态
              updateBatteryStatus();
            })();
          })();

          (function apps() {
            // 应用程序：创建一个进程，该进程可创建多个窗口，当所有该进程的窗口都关闭时，进程自动退出
            async function application(appProcessId, windowConfigs) {
              await pManager.createProcess(appProcessId);

              var count = 0;

              // 跟踪窗口关闭状态
              let windows = [];

              windowConfigs.forEach((windowConfig) => {
                // 创建窗口
                const windowId = wManager.createWindow(
                  appProcessId,
                  windowConfig
                );

                // 焦点
                fManager.focusWindow(windowId);
                wManager.focusWindow(windowId);

                // 通过事件监听来监控窗口关闭
                const windowObj = { windowId: windowId, closed: false };
                windows[count] = windowObj;

                // 监听窗口关闭事件
                const closeHandler = () => {
                  windowObj.closed = true;
                  // 检查是否所有窗口都已关闭
                  const allClosed = windows.every((w) => w.closed);
                  if (allClosed) {
                    // 所有窗口都已关闭，终止进程
                    pManager.terminateProcess(appProcessId);
                  }
                };

                // 设置关闭处理器
                const windowInstance = wManager.windows.get(windowId);
                if (windowInstance) {
                  windowInstance.setCloseHandler(closeHandler);
                } else {
                  console.warn(`未找到窗口实例: ${windowId}`);
                }

                count++;
              });
            }

            document
              .querySelector("taskbar-container bar-space .app-launcher")
              .addEventListener("click", () => {
                const launcherPath =
                  "../../../packages/pageos-app-launcher/0.1.4/";
                const iframe = document.createElement("iframe");
                iframe.style.cssText =
                  "width: 100%; height: 100%; border: none;";
                iframe.src = `${launcherPath}index.html`;

                // 监听菜单 iframe 加载完成事件
                iframe.addEventListener("load", function () {
                  // 获取 iframe 内部文档对象
                  const iframeDoc =
                    iframe.contentDocument || iframe.contentWindow.document;

                  // 初始化右键菜单
                  initOptionMenu(iframeDoc);

                  // 在 iframe 内部文档上绑定点击事件
                  iframeDoc.addEventListener("click", async function (event) {
                    const anchor = event.target.closest('a[data-pageos="app"]');
                    if (
                      anchor &&
                      anchor.href &&
                      anchor.href.endsWith("metadata.json")
                    ) {
                      try {
                        event.preventDefault();
                        const response = await fetch(anchor.href);
                        const metadata = await response.json();
                        const newIframe = document.createElement("iframe");
                        newIframe.style.cssText =
                          "width: 100%; height: 100%; border: none;";
                        newIframe.src = new URL(
                          metadata.entry,
                          anchor.href
                        ).href;
                        application(metadata.id, [
                          {
                            icon: metadata.icon
                              ? `<img src="${
                                  new URL(metadata.icon, anchor.href).href
                                }" />`
                              : metadata.id[0],
                            title: metadata.name,
                            width: window.screen.width * 0.6,
                            height: window.screen.height * 0.6,
                            x: window.screen.width * 0.2,
                            y: window.screen.height * 0.2,
                            tabs: [
                              {
                                title: metadata.name,
                                content: newIframe,
                              },
                            ],
                          },
                        ]);
                      } catch (error) {
                        console.error("加载 metadata.json 失败:", error);
                      }
                    }
                  });
                });

                application("pageos-app-launcher", [
                  {
                    icon: `<img src="${launcherPath}assets/icon.svg" />`,
                    title: "PageOS 应用启动器",
                    width:
                      window.screen.width * 0.9 > 1024
                        ? 1024
                        : window.screen.width * 0.9,
                    height: window.screen.height * 0.6,
                    x:
                      (window.screen.width -
                        (window.screen.width * 0.9 > 1024
                          ? 1024
                          : window.screen.width * 0.9)) *
                      0.5,
                    y: window.screen.height * 0.25,
                    tabs: [
                      {
                        title: "PageOS 应用启动器",
                        content: iframe,
                      },
                    ],
                  },
                ]);
              });
          })();
        })();
      })();
    </script>
  </body>
</html>
